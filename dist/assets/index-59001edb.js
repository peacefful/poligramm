import{h as Q,T as he,R as O,U as j,V as W,W as ge,X as ve,Y as _e,Z as ye,_ as A,o as u,n as v,m as l,d as _,s as B,k as m,t as M,l as a,$ as Ce,u as X,z as Y,E as we,j as x,w as g,P as I,e as U,a0 as xe,q as w,a1 as V,a2 as be,c as Me,a3 as J,D as R,L as ee,a4 as $e,N as ke,a5 as De,Q as K,K as te,a6 as N,a7 as Ie,a8 as Ue,a9 as E,G as Se,aa as se,ab as ae,F as oe,p as P,ac as Oe,ad as L,ae as ne,af as Ae,r as Pe}from"./index-48391db5.js";import{M as je}from"./MainLayout-a2af3593.js";import{C as H,D as Be,_ as q,p as Fe,a as Te,A as Ne}from"./chart-98e77abe.js";const Ee=async()=>{try{return(await Q.get("/api/chats")).data}catch{return new Error("Error fetch chats")}},Le=async t=>{await Q.put(`/api/chats/${t.id}`,t.data)},re=async(t,e)=>{t.sendTime=he().format("HH:mm"),(t.text.trim()||t.file.trim())&&(t.chatId=e,O.emit("message",t),t.text="")},le=async()=>{const t=j();O.on("message",e=>{t.setMessages(e),requestAnimationFrame(()=>{window.scrollTo(0,document.body.scrollHeight)})})},ie=async t=>W.getFileView("676081be001c55b9da7d",t),de=t=>O.emit("join",t),ue=async t=>{try{return await W.createFile("676081be001c55b9da7d",ge.unique(),t)}catch{return null}},z=Object.freeze(Object.defineProperty({__proto__:null,createChat:ve,deleteChat:_e,fetchChat:ye,fetchChats:Ee,getFileView:ie,getMessages:le,joinToChat:de,sendMessage:re,setFileToStorage:ue,updateChat:Le},Symbol.toStringTag,{value:"Module"})),Ve={},Re={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6 w-12 h-12"};function He(t,e){return u(),v("svg",Re,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"},null,-1)]))}const Ke=A(Ve,[["render",He]]),qe={class:"flex flex-col"},ze=["href"],Ze={key:1},Ge={class:"text-xs text-right"},Qe=_({__name:"Messages",props:{message:{}},setup(t){const e=B.getData("id"),s=o=>o!==null?+o:0;return(o,i)=>(u(),v("div",qe,[l("div",{class:Ce(["bg-default text-white rounded-2xl my-2 p-3 break-words inline-block max-w-xl",{"ml-auto mr-4":s(a(e))===+o.message.userId,"mr-auto ml-4":s(a(e))!==+o.message.userId}])},[o.message.file?(u(),v("a",{key:0,target:"_blank",class:"cursor-pointer",href:o.message.file},[m(Ke)],8,ze)):(u(),v("div",Ze,M(o.message.text),1)),l("div",Ge,M(s(a(e))===+o.message.userId?"Вы":o.message.username)+" "+M(o.message.sendTime),1)],2)]))}}),We=t=>{const e=t.split("/"),s=e[e.length-2],o=e[e.length-1];return{id:s,uuid:o}},Z=t=>{const{id:e,uuid:s}=We(t.route);return de(s),t.getChat(+e),s},Xe=()=>{const t=X();function e(s){s.key==="Escape"&&t.push("/chats")}Y(()=>{window.addEventListener("keydown",e)}),we(()=>{window.removeEventListener("keydown",e)})},Ye=t=>(console.log("deleteChatByIndex"),t.chats.filter(e=>e.id!==t.id)),Je={},et={xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 mr-[2px] mt-[2px]",viewBox:"0 0 24 24",fill:"#fff",stroke:"#fff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"};function tt(t,e){return u(),v("svg",et,e[0]||(e[0]=[l("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),l("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)]))}const st=A(Je,[["render",tt]]),at=_({__name:"SendMessageButton",emits:["send-message"],setup(t){return(e,s)=>(u(),x(a(I),{onClick:s[0]||(s[0]=o=>e.$emit("send-message")),"is-rounded-full":!0},{default:g(()=>[m(st)]),_:1}))}}),ot={},nt={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"2",stroke:"#fff",class:"w-6 h-6"};function rt(t,e){return u(),v("svg",nt,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"},null,-1)]))}const lt=A(ot,[["render",rt]]),it=_({__name:"SendFileButton",setup(t){const e=U(""),s=j(),o=async i=>{const d=i.target;if(d.files!==null){const r=await ue(d.files[0]);r&&(e.value=await ie(r==null?void 0:r.$id),s.messagesData.file=e.value,re(s.messagesData,1),console.log("currentFileUrl",e))}};return(i,d)=>(u(),x(a(xe),{onOnFileChange:o,type:"file",class:"p-2 mr-4 hover:rotate-90 ease-in duration-150"},{default:g(()=>[m(lt)]),_:1}))}}),dt={class:"flex justify-center gap-3 mt-4"},ut=_({__name:"ConfirmDeleteChatModal",props:{isOpenModal:{type:Boolean},chatId:{}},emits:["closeModal","deleteCurrentChat"],setup(t){return(e,s)=>(u(),x(a(V),{onCloseModal:s[2]||(s[2]=o=>e.$emit("closeModal")),"is-open-modal":e.isOpenModal},{default:g(()=>[s[5]||(s[5]=l("h3",null,"Вы уверены что хотите удалить данный чат?",-1)),l("div",dt,[m(a(I),{onClick:s[0]||(s[0]=o=>e.$emit("deleteCurrentChat",e.chatId)),class:"w-20",color:"primary","is-rounded-lg":!0},{default:g(()=>s[3]||(s[3]=[w(" Да ")])),_:1}),m(a(I),{onClick:s[1]||(s[1]=o=>e.$emit("closeModal")),class:"w-20","is-rounded-lg":!0},{default:g(()=>s[4]||(s[4]=[w(" Нет ")])),_:1})])]),_:1},8,["is-open-modal"]))}}),ct={class:"fixed top-0 left-[383px] right-0 bg-white h-[70px] px-4 flex justify-between items-center"},mt={class:"flex items-center"},pt={class:"bg-default p-2 rounded-full mr-2"},ft={class:"font-bold text-xl"},ht=_({__name:"ChatHeader",props:{chatName:{}},emits:["openModal"],setup(t){return(e,s)=>(u(),v("header",{onClick:s[0]||(s[0]=o=>e.$emit("openModal")),class:"cursor-pointer mb-20"},[l("div",ct,[l("div",mt,[l("div",pt,[m(a(be),{class:"h-8 w-8",name:"usersGroup"})]),l("h1",ft,M(e.chatName),1)])])]))}}),gt=["placeholder"],vt=_({__name:"SendMessageForm",props:{uuid:{},chatId:{}},setup(t){const e=t,{t:s}=Me({useScope:"global"}),o=J(),i=j(),d=String(B.getData("id"));return i.setMessagesData({userId:d,chatId:e.chatId,text:"",sendTime:"",file:"",username:o.username,uuid:e.uuid}),R(e,()=>{i.messagesData.uuid=e.uuid}),le(),(r,n)=>(u(),v("form",{autocomplete:"off",onSubmit:n[2]||(n[2]=K(h=>a(z).sendMessage(a(i).messagesData,r.chatId),["prevent"])),class:"relative bottom-0 mx-0 mb-0 rounded-none md:sticky md:bottom-3 md:mx-4 md:mb-3 md:rounded-2xl flex justify-center items-center bg-white px-6"},[m(a(it)),ee(l("textarea",ke({onKeydown:n[0]||(n[0]=De(K(h=>a(z).sendMessage(a(i).messagesData,r.chatId),["prevent"]),["enter"]))},r.$attrs,{class:"outline-none border-solid resize-none overflow-hidden w-full pt-5",placeholder:a(s)("writeMessage"),"onUpdate:modelValue":n[1]||(n[1]=h=>a(i).messagesData.text=h)}),null,16,gt),[[$e,a(i).messagesData.text]]),m(a(at))],32))}}),ce={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},_t={ariaLabel:{type:String},ariaDescribedby:{type:String}},yt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...ce,..._t},Ct=Ie[0]==="2"?(t,e)=>Object.assign(t,{attrs:e}):(t,e)=>Object.assign(t,e);function S(t){return se(t)?E(t):t}function wt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return se(e)?new Proxy(t,{}):t}function xt(t,e){const s=t.options;s&&e&&Object.assign(s,e)}function me(t,e){t.labels=e}function pe(t,e,s){const o=[];t.datasets=e.map(i=>{const d=t.datasets.find(r=>r[s]===i[s]);return!d||!i.data||o.includes(d)?{...i}:(o.push(d),Object.assign(d,i),d)})}function bt(t,e){const s={labels:[],datasets:[]};return me(s,t.labels),pe(s,t.datasets,e),s}const Mt=_({props:yt,setup(t,e){let{expose:s,slots:o}=e;const i=U(null),d=te(null);s({chart:d});const r=()=>{if(!i.value)return;const{type:p,data:$,options:C,plugins:y,datasetIdKey:b}=t,k=bt($,b),c=wt(k,$);d.value=new H(i.value,{type:p,data:c,options:{...C},plugins:y})},n=()=>{const p=E(d.value);p&&(t.destroyDelay>0?setTimeout(()=>{p.destroy(),d.value=null},t.destroyDelay):(p.destroy(),d.value=null))},h=p=>{p.update(t.updateMode)};return Y(r),Ue(n),R([()=>t.options,()=>t.data],(p,$)=>{let[C,y]=p,[b,k]=$;const c=E(d.value);if(!c)return;let f=!1;if(C){const D=S(C),F=S(b);D&&D!==F&&(xt(c,D),f=!0)}if(y){const D=S(y.labels),F=S(k.labels),T=S(y.datasets),fe=S(k.datasets);D!==F&&(me(c.config.data,D),f=!0),T&&T!==fe&&(pe(c.config.data,T,t.datasetIdKey),f=!0)}f&&Se(()=>{h(c)})},{deep:!0}),()=>N("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:i},[N("p",{},[o.default?o.default():""])])}});function $t(t,e){return H.register(e),_({props:ce,setup(s,o){let{expose:i}=o;const d=te(null),r=n=>{d.value=n==null?void 0:n.chart};return i({chart:d}),()=>N(Mt,Ct({ref:r},{type:t,...s}))}})}const G=$t("doughnut",Be),kt={class:"flex justify-between"},Dt=["value"],It=_({__name:"inviteUsers",props:{isOpenAddUser:{type:Boolean},users:{},chatName:{},chatUuid:{},chat:{}},emits:["closeAddUser"],setup(t){const e=t,s=U([]),o=U(!1),i=U(!1),d=()=>{s.value.length?(s.value.forEach(r=>{O.emit("personalInvite",r),O.emit("messageInvite",{uuidRoom:e.chat.uuid,titleRoom:e.chat.roomName,roomId:e.chat.id,userUuid:r}),O.emit("personalInvite",B.getData("uuid"))}),s.value.length=0,i.value=!0):o.value=!0};return(r,n)=>(u(),x(a(V),{class:"w-[440px]",onCloseModal:n[1]||(n[1]=h=>r.$emit("closeAddUser")),"is-open-modal":r.isOpenAddUser},{default:g(()=>[l("ul",null,[n[2]||(n[2]=l("p",{class:"font-bold text-[20px]"},"Выберите пользователей",-1)),(u(!0),v(oe,null,ae(r.users,h=>(u(),v("li",{class:"mt-4",key:h.id},[l("div",kt,[w(M(h.name)+" "+M(h.surname)+" ",1),ee(l("input",{type:"checkbox",value:h.uuid,"onUpdate:modelValue":n[0]||(n[0]=p=>s.value=p)},null,8,Dt),[[Oe,s.value]])])]))),128))]),m(a(I),{onClick:d,class:"mt-7 w-full","is-rounded-lg":!0},{default:g(()=>n[3]||(n[3]=[w(" Добавить ")])),_:1}),o.value?(u(),x(a(q),{key:0,class:"text-center mt-2","type-toast":"error"},{default:g(()=>n[4]||(n[4]=[w(" Ошибка, вы не выбрали пользователей ")])),_:1})):P("",!0),i.value?(u(),x(a(q),{key:1,class:"text-center mt-2","type-toast":"success"},{default:g(()=>n[5]||(n[5]=[w(" Пользователям отправлены приглашения ")])),_:1})):P("",!0)]),_:1},8,["is-open-modal"]))}}),Ut={},St={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 w-6"};function Ot(t,e){return u(),v("svg",St,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"},null,-1)]))}const At=A(Ut,[["render",Ot]]),Pt={class:"flex flex-col h-full"},jt={class:"text-3xl font-bold"},Bt={class:"mt-4"},Ft={class:"mt-12"},Tt={class:"mt-4 grid grid-cols-3 gap-1"},Nt={class:"mt-4"},Et={key:0,class:"mt-auto ml-auto flex gap-2"},Lt=_({__name:"AnalysisChat",props:{chat:{}},emits:["closeModal"],setup(t){const{isOpenModal:e,closeModal:s,openModal:o}=L(),{isOpenModal:i,closeModal:d,openModal:r}=L(),n=B.getData("id"),h=ne(),p=J();p.getUsers();const $=X(),C=c=>{h.removeChat(c),Ye({chats:p.user.chats,id:c}),p.getUser(n!==null?+n:0),s(),$.push("/chats")};H.register(Fe,Te,Ne);const y=U({labels:["Text","Files","Others"],datasets:[{backgroundColor:["#242424","#bc0ce8","#279eff"],data:[50,2,27]}]}),b=U({labels:["Images","Videos"],datasets:[{backgroundColor:["#242424","#279eff"],data:[30,10]}]}),k={responsive:!0,maintainAspectRatio:!1};return(c,f)=>(u(),v("section",Pt,[l("div",null,[l("h1",jt,M(c.chat.roomName),1),l("p",Bt,M(c.chat.description),1),l("div",Ft,[f[1]||(f[1]=l("h2",{class:"text-2xl"},"Анализ чата:",-1)),l("div",Tt,[l("div",null,[m(a(G),{class:"chart",options:k,data:y.value},null,8,["data"])]),l("div",null,[m(a(G),{class:"chart",options:k,data:b.value},null,8,["data"])])])]),f[3]||(f[3]=l("div",{class:"h-[0.5px] mt-4 bg-slate-400"},null,-1)),l("div",Nt,[a(n)&&+a(n)===c.chat.userId?(u(),x(a(I),{key:0,onClick:a(r),class:"gap-2","is-rounded-lg":!0},{default:g(()=>[f[2]||(f[2]=w(" Пригласить пользователей ")),m(At)]),_:1},8,["onClick"])):P("",!0)])]),a(n)&&+a(n)===c.chat.userId?(u(),v("div",Et,[m(a(I),{onClick:f[0]||(f[0]=D=>c.$emit("closeModal")),class:"w-32",color:"primary","is-rounded-lg":!0},{default:g(()=>f[4]||(f[4]=[w(" Закрыть ")])),_:1}),m(a(I),{onClick:a(o),class:"w-32",color:"danger","is-rounded-lg":!0},{default:g(()=>f[5]||(f[5]=[w(" Удалить чат ")])),_:1},8,["onClick"])])):P("",!0),m(a(ut),{"is-open-modal":a(e),chatId:c.chat.id,onCloseModal:a(s),onDeleteCurrentChat:C},null,8,["is-open-modal","chatId","onCloseModal"]),m(a(It),{"is-open-add-user":a(i),users:a(p).users,chatName:c.chat.roomName,chatUuid:c.chat.uuid,chat:c.chat,onCloseAddUser:a(d)},null,8,["is-open-add-user","users","chatName","chatUuid","chat","onCloseAddUser"])]))}});const Vt=A(Lt,[["__scopeId","data-v-4e0b24a4"]]),Rt={class:"flex flex-col justify-between min-h-screen"},zt=_({__name:"Chat",setup(t){Xe();const e=Ae(),{isOpenModal:s,closeModal:o,openModal:i}=L(),d=j(),r=ne(),n=Pe({route:e.fullPath,getChat:r.getChat});let h=Z(n);return R(e,()=>{h=Z({route:e.fullPath,getChat:r.getChat})}),(p,$)=>(u(),x(a(je),null,{default:g(()=>{var C,y;return[l("div",Rt,[m(a(ht),{onOpenModal:a(i),"chat-name":(y=(C=a(r))==null?void 0:C.chat)==null?void 0:y.roomName},null,8,["onOpenModal","chat-name"]),l("div",null,[(u(!0),v(oe,null,ae(a(d).getMessages(a(r).chat.messages),b=>(u(),x(a(Qe),{key:b.userId,message:b},null,8,["message"]))),128)),m(a(vt),{"chat-id":a(r).chat.id,uuid:a(h)},null,8,["chat-id","uuid"])])]),m(a(V),{class:"w-[900px] h-[800px]",onCloseModal:a(o),"is-open-modal":a(s)},{default:g(()=>[m(a(Vt),{onCloseModal:a(o),chat:a(r).chat},null,8,["onCloseModal","chat"])]),_:1},8,["onCloseModal","is-open-modal"])]}),_:1}))}});export{zt as default};
