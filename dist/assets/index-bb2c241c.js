import{h as X,T as ve,R as I,U as T,V as Y,W as _e,X as ye,Y as Ce,Z as we,_ as N,o as u,n as v,m as l,d as C,s as B,k as f,t as D,l as a,$ as xe,u as J,z as ee,E as be,j as $,w as y,P as O,e as U,a0 as Me,q as M,a1 as R,a2 as $e,c as ke,a3 as te,D as V,L as se,a4 as Ie,N as De,a5 as Ue,Q as K,K as ae,a6 as F,a7 as Se,a8 as Oe,a9 as E,G as Ae,aa as oe,ab as ne,F as re,p as P,ac as je,ad as L,ae as le,af as Ne,r as q,b as z,i as Pe}from"./index-6e4cb065.js";import{u as Te,M as Be}from"./MainLayout-d9039cb6.js";import{C as H,D as Fe,_ as Z,p as Ee,a as Le,A as Re}from"./chart-2509dd0f.js";const Ve=async()=>{try{return(await X.get("/api/chats")).data}catch{return new Error("Error fetch chats")}},He=async t=>{await X.put(`/api/chats/${t.id}`,t.data)},ie=async(t,e)=>{t.sendTime=ve().format("HH:mm"),(t.text.trim()||t.file.trim())&&(t.chatId=e,I.emit("message",t),t.text="")},de=async()=>{const t=T();I.on("message",e=>{t.setMessages(e),requestAnimationFrame(()=>{window.scrollTo(0,document.body.scrollHeight)})})},ue=async t=>Y.getFileView("676081be001c55b9da7d",t),ce=t=>I.emit("join",t),me=async t=>{try{return await Y.createFile("676081be001c55b9da7d",_e.unique(),t)}catch{return null}},G=Object.freeze(Object.defineProperty({__proto__:null,createChat:ye,deleteChat:Ce,fetchChat:we,fetchChats:Ve,getFileView:ue,getMessages:de,joinToChat:ce,sendMessage:ie,setFileToStorage:me,updateChat:He},Symbol.toStringTag,{value:"Module"})),Ke={},qe={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6 w-12 h-12"};function ze(t,e){return u(),v("svg",qe,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"},null,-1)]))}const Ze=N(Ke,[["render",ze]]),Ge={class:"flex flex-col"},Qe=["href"],We={key:1},Xe={class:"text-xs text-right"},Ye=C({__name:"Messages",props:{message:{}},setup(t){const e=B.getData("id"),s=o=>o!==null?+o:0;return(o,i)=>(u(),v("div",Ge,[l("div",{class:xe(["bg-default text-white rounded-2xl my-2 p-3 break-words inline-block max-w-xl",{"ml-auto mr-4":s(a(e))===+o.message.userId,"mr-auto ml-4":s(a(e))!==+o.message.userId}])},[o.message.file?(u(),v("a",{key:0,target:"_blank",class:"cursor-pointer",href:o.message.file},[f(Ze)],8,Qe)):(u(),v("div",We,D(o.message.text),1)),l("div",Xe,D(s(a(e))===+o.message.userId?"Вы":o.message.username)+" "+D(o.message.sendTime),1)],2)]))}}),Je=t=>{const e=t.split("/"),s=e[e.length-2],o=e[e.length-1];return{id:s,uuid:o}},Q=t=>{const{id:e,uuid:s}=Je(t.route);return ce(s),t.getChat(+e),s},et=()=>{const t=J();function e(s){s.key==="Escape"&&t.push("/chats")}ee(()=>{window.addEventListener("keydown",e)}),be(()=>{window.removeEventListener("keydown",e)})},tt=t=>(console.log("deleteChatByIndex"),t.chats.filter(e=>e.id!==t.id)),st={},at={xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 mr-[2px] mt-[2px]",viewBox:"0 0 24 24",fill:"#fff",stroke:"#fff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"};function ot(t,e){return u(),v("svg",at,e[0]||(e[0]=[l("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),l("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)]))}const nt=N(st,[["render",ot]]),rt=C({__name:"SendMessageButton",emits:["send-message"],setup(t){return(e,s)=>(u(),$(a(O),{onClick:s[0]||(s[0]=o=>e.$emit("send-message")),"is-rounded-full":!0},{default:y(()=>[f(nt)]),_:1}))}}),lt={},it={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"2",stroke:"#fff",class:"w-6 h-6"};function dt(t,e){return u(),v("svg",it,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"},null,-1)]))}const ut=N(lt,[["render",dt]]),ct=C({__name:"SendFileButton",setup(t){const e=U(""),s=T(),o=async i=>{const d=i.target;if(d.files!==null){const r=await me(d.files[0]);r&&(e.value=await ue(r==null?void 0:r.$id),s.messagesData.file=e.value,ie(s.messagesData,1),console.log("currentFileUrl",e))}};return(i,d)=>(u(),$(a(Me),{onOnFileChange:o,type:"file",class:"p-2 mr-4 hover:rotate-90 ease-in duration-150"},{default:y(()=>[f(ut)]),_:1}))}}),mt={class:"flex justify-center gap-3 mt-4"},pt=C({__name:"ConfirmDeleteChatModal",props:{isOpenModal:{type:Boolean},chatId:{}},emits:["closeModal","deleteCurrentChat"],setup(t){return(e,s)=>(u(),$(a(R),{onCloseModal:s[2]||(s[2]=o=>e.$emit("closeModal")),"is-open-modal":e.isOpenModal},{default:y(()=>[s[5]||(s[5]=l("h3",null,"Вы уверены что хотите удалить данный чат?",-1)),l("div",mt,[f(a(O),{onClick:s[0]||(s[0]=o=>e.$emit("deleteCurrentChat",e.chatId)),class:"w-20",color:"primary","is-rounded-lg":!0},{default:y(()=>s[3]||(s[3]=[M(" Да ")])),_:1}),f(a(O),{onClick:s[1]||(s[1]=o=>e.$emit("closeModal")),class:"w-20","is-rounded-lg":!0},{default:y(()=>s[4]||(s[4]=[M(" Нет ")])),_:1})])]),_:1},8,["is-open-modal"]))}}),ft={class:"fixed top-0 left-[383px] right-0 bg-white h-[70px] px-4 flex justify-between items-center"},ht={class:"flex items-center"},gt={class:"bg-default p-2 rounded-full mr-2"},vt={class:"font-bold text-xl"},_t=C({__name:"ChatHeader",props:{chatName:{}},emits:["openModal"],setup(t){return(e,s)=>(u(),v("header",{onClick:s[0]||(s[0]=o=>e.$emit("openModal")),class:"cursor-pointer mb-20"},[l("div",ft,[l("div",ht,[l("div",gt,[f(a($e),{class:"h-8 w-8",name:"usersGroup"})]),l("h1",vt,D(e.chatName),1)])])]))}}),yt=["placeholder"],Ct=C({__name:"SendMessageForm",props:{uuid:{},chatId:{}},setup(t){const e=t,{t:s}=ke({useScope:"global"}),o=te(),i=T(),d=String(B.getData("id"));return i.setMessagesData({userId:d,chatId:e.chatId,text:"",sendTime:"",file:"",username:o.username,uuid:e.uuid}),V(e,()=>{i.messagesData.uuid=e.uuid}),de(),(r,n)=>(u(),v("form",{autocomplete:"off",onSubmit:n[2]||(n[2]=K(g=>a(G).sendMessage(a(i).messagesData,r.chatId),["prevent"])),class:"relative bottom-0 mx-0 mb-0 rounded-none md:sticky md:bottom-3 md:mx-4 md:mb-3 md:rounded-2xl flex justify-center items-center bg-white px-6"},[f(a(ct)),se(l("textarea",De({onKeydown:n[0]||(n[0]=Ue(K(g=>a(G).sendMessage(a(i).messagesData,r.chatId),["prevent"]),["enter"]))},r.$attrs,{class:"outline-none border-solid resize-none overflow-hidden w-full pt-5",placeholder:a(s)("writeMessage"),"onUpdate:modelValue":n[1]||(n[1]=g=>a(i).messagesData.text=g)}),null,16,yt),[[Ie,a(i).messagesData.text]]),f(a(rt))],32))}}),pe={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},wt={ariaLabel:{type:String},ariaDescribedby:{type:String}},xt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...pe,...wt},bt=Se[0]==="2"?(t,e)=>Object.assign(t,{attrs:e}):(t,e)=>Object.assign(t,e);function j(t){return oe(t)?E(t):t}function Mt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return oe(e)?new Proxy(t,{}):t}function $t(t,e){const s=t.options;s&&e&&Object.assign(s,e)}function fe(t,e){t.labels=e}function he(t,e,s){const o=[];t.datasets=e.map(i=>{const d=t.datasets.find(r=>r[s]===i[s]);return!d||!i.data||o.includes(d)?{...i}:(o.push(d),Object.assign(d,i),d)})}function kt(t,e){const s={labels:[],datasets:[]};return fe(s,t.labels),he(s,t.datasets,e),s}const It=C({props:xt,setup(t,e){let{expose:s,slots:o}=e;const i=U(null),d=ae(null);s({chart:d});const r=()=>{if(!i.value)return;const{type:p,data:h,options:x,plugins:b,datasetIdKey:k}=t,_=kt(h,k),c=Mt(_,h);d.value=new H(i.value,{type:p,data:c,options:{...x},plugins:b})},n=()=>{const p=E(d.value);p&&(t.destroyDelay>0?setTimeout(()=>{p.destroy(),d.value=null},t.destroyDelay):(p.destroy(),d.value=null))},g=p=>{p.update(t.updateMode)};return ee(r),Oe(n),V([()=>t.options,()=>t.data],(p,h)=>{let[x,b]=p,[k,_]=h;const c=E(d.value);if(!c)return;let m=!1;if(x){const w=j(x),A=j(k);w&&w!==A&&($t(c,w),m=!0)}if(b){const w=j(b.labels),A=j(_.labels),S=j(b.datasets),ge=j(_.datasets);w!==A&&(fe(c.config.data,w),m=!0),S&&S!==ge&&(he(c.config.data,S,t.datasetIdKey),m=!0)}m&&Ae(()=>{g(c)})},{deep:!0}),()=>F("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:i},[F("p",{},[o.default?o.default():""])])}});function Dt(t,e){return H.register(e),C({props:pe,setup(s,o){let{expose:i}=o;const d=ae(null),r=n=>{d.value=n==null?void 0:n.chart};return i({chart:d}),()=>F(It,bt({ref:r},{type:t,...s}))}})}const W=Dt("doughnut",Fe),Ut={class:"flex justify-between"},St=["value"],Ot=C({__name:"inviteUsers",props:{isOpenAddUser:{type:Boolean},users:{},chatName:{},chatUuid:{},chat:{}},emits:["closeAddUser"],setup(t){const e=t,s=U([]),o=U(!1),i=U(!1),d=()=>{s.value.length?(s.value.forEach(r=>{I.emit("personalInvite",r),I.emit("messageInvite",{uuidRoom:e.chat.uuid,titleRoom:e.chat.roomName,roomId:e.chat.id,userUuid:r}),I.emit("personalInvite",B.getData("uuid"))}),s.value.length=0,i.value=!0):o.value=!0};return(r,n)=>(u(),$(a(R),{class:"w-[440px]",onCloseModal:n[1]||(n[1]=g=>r.$emit("closeAddUser")),"is-open-modal":r.isOpenAddUser},{default:y(()=>[l("ul",null,[n[2]||(n[2]=l("p",{class:"font-bold text-[20px]"},"Выберите пользователей",-1)),(u(!0),v(re,null,ne(r.users,g=>(u(),v("li",{class:"mt-4",key:g.id},[l("div",Ut,[M(D(g.name)+" "+D(g.surname)+" ",1),se(l("input",{type:"checkbox",value:g.uuid,"onUpdate:modelValue":n[0]||(n[0]=p=>s.value=p)},null,8,St),[[je,s.value]])])]))),128))]),f(a(O),{onClick:d,class:"mt-7 w-full","is-rounded-lg":!0},{default:y(()=>n[3]||(n[3]=[M(" Добавить ")])),_:1}),o.value?(u(),$(a(Z),{key:0,class:"text-center mt-2","type-toast":"error"},{default:y(()=>n[4]||(n[4]=[M(" Ошибка, вы не выбрали пользователей ")])),_:1})):P("",!0),i.value?(u(),$(a(Z),{key:1,class:"text-center mt-2","type-toast":"success"},{default:y(()=>n[5]||(n[5]=[M(" Пользователям отправлены приглашения ")])),_:1})):P("",!0)]),_:1},8,["is-open-modal"]))}}),At={},jt={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 w-6"};function Nt(t,e){return u(),v("svg",jt,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"},null,-1)]))}const Pt=N(At,[["render",Nt]]),Tt={class:"flex flex-col h-full"},Bt={class:"text-3xl font-bold"},Ft={class:"mt-4"},Et={class:"mt-12"},Lt={class:"mt-4 grid grid-cols-3 gap-1"},Rt={class:"mt-4"},Vt={key:0,class:"mt-auto ml-auto flex gap-2"},Ht=C({__name:"AnalysisChat",props:{chat:{}},emits:["closeModal"],setup(t){const{isOpenModal:e,closeModal:s,openModal:o}=L(),{isOpenModal:i,closeModal:d,openModal:r}=L(),n=B.getData("id"),g=le(),p=te();p.getUsers();const h=J(),x=c=>{g.removeChat(c),tt({chats:p.user.chats,id:c}),p.getUser(n!==null?+n:0),s(),h.push("/chats")};H.register(Ee,Le,Re);const b=U({labels:["Text","Files","Others"],datasets:[{backgroundColor:["#242424","#bc0ce8","#279eff"],data:[50,2,27]}]}),k=U({labels:["Images","Videos"],datasets:[{backgroundColor:["#242424","#279eff"],data:[30,10]}]}),_={responsive:!0,maintainAspectRatio:!1};return(c,m)=>(u(),v("section",Tt,[l("div",null,[l("h1",Bt,D(c.chat.roomName),1),l("p",Ft,D(c.chat.description),1),l("div",Et,[m[1]||(m[1]=l("h2",{class:"text-2xl"},"Анализ чата:",-1)),l("div",Lt,[l("div",null,[f(a(W),{class:"chart",options:_,data:b.value},null,8,["data"])]),l("div",null,[f(a(W),{class:"chart",options:_,data:k.value},null,8,["data"])])])]),m[3]||(m[3]=l("div",{class:"h-[0.5px] mt-4 bg-slate-400"},null,-1)),l("div",Rt,[a(n)&&+a(n)===c.chat.userId?(u(),$(a(O),{key:0,onClick:a(r),class:"gap-2","is-rounded-lg":!0},{default:y(()=>[m[2]||(m[2]=M(" Пригласить пользователей ")),f(Pt)]),_:1},8,["onClick"])):P("",!0)])]),a(n)&&+a(n)===c.chat.userId?(u(),v("div",Vt,[f(a(O),{onClick:m[0]||(m[0]=w=>c.$emit("closeModal")),class:"w-32",color:"primary","is-rounded-lg":!0},{default:y(()=>m[4]||(m[4]=[M(" Закрыть ")])),_:1}),f(a(O),{onClick:a(o),class:"w-32",color:"danger","is-rounded-lg":!0},{default:y(()=>m[5]||(m[5]=[M(" Удалить чат ")])),_:1},8,["onClick"])])):P("",!0),f(a(pt),{"is-open-modal":a(e),chatId:c.chat.id,onCloseModal:a(s),onDeleteCurrentChat:x},null,8,["is-open-modal","chatId","onCloseModal"]),f(a(Ot),{"is-open-add-user":a(i),users:a(p).users,chatName:c.chat.roomName,chatUuid:c.chat.uuid,chat:c.chat,onCloseAddUser:a(d)},null,8,["is-open-add-user","users","chatName","chatUuid","chat","onCloseAddUser"])]))}});const Kt=N(Ht,[["__scopeId","data-v-4e0b24a4"]]),qt={key:0,class:"flex flex-col justify-between min-h-screen"},zt={key:1,class:"flex flex-col justify-center items-center min-h-screen"},Wt=C({__name:"Chat",setup(t){et();const e=Ne(),{isOpenModal:s,closeModal:o,openModal:i}=L(),d=T(),r=le(),n=q({route:e.fullPath,getChat:r.getChat});let g=Q(n);V(e,()=>{g=Q({route:e.fullPath,getChat:r.getChat})});const p=U(!1),h=q({title:"",uuid:"",userUuid:!1,roomId:null}),x=()=>p.value=!1;I.emit("personalInvite",z.get("uuid")),I.on("messageInvite",async(k,_,c,m)=>{h.title=_,h.uuid=k,h.roomId=m,h.userUuid=c===z.get("uuid"),h.title&&h.uuid&&h.userUuid&&(p.value=!0,setTimeout(()=>p.value=!1,5e3))});const{enterChat:b}=Te();return(k,_)=>{const c=Pe("Notification");return u(),$(a(Be),null,{default:y(()=>{var m,w,A;return[(m=a(r))!=null&&m.chat?(u(),v("div",qt,[f(a(_t),{onOpenModal:a(i),"chat-name":(A=(w=a(r))==null?void 0:w.chat)==null?void 0:A.roomName},null,8,["onOpenModal","chat-name"]),l("div",null,[(u(!0),v(re,null,ne(a(d).getMessages(a(r).chat.messages),S=>(u(),$(a(Ye),{key:S.userId,message:S},null,8,["message"]))),128)),f(a(Ct),{"chat-id":a(r).chat.id,uuid:a(g)},null,8,["chat-id","uuid"])])])):(u(),v("div",zt,_[1]||(_[1]=[l("p",{class:"text-white bg-black p-2 rounded-xl"},"Чата был удален",-1)]))),f(a(R),{class:"w-[900px] h-[800px]",onCloseModal:a(o),"is-open-modal":a(s)},{default:y(()=>[f(a(Kt),{onCloseModal:a(o),chat:a(r).chat},null,8,["onCloseModal","chat"])]),_:1},8,["onCloseModal","is-open-modal"]),f(c,{"is-invite-room":p.value,chatTitle:h.title,onEnterChat:_[0]||(_[0]=S=>a(b)(h.uuid,h.title,h.roomId,x)),onCloseNotification:x},null,8,["is-invite-room","chatTitle"])]}),_:1})}}});export{Wt as default};
