import{h as Z,T as _e,R as O,U as T,V as ee,W as ye,X as we,Y as Ce,Z as xe,_ as B,o as d,n as v,m as n,d as $,c as N,s as E,k as g,t as h,l as s,$ as be,u as te,z as q,E as Me,j as D,w as C,P as A,e as L,a0 as $e,q as S,a1 as z,a2 as se,a3 as ae,D as F,L as oe,a4 as ke,N as De,a5 as Ie,Q,K as ne,a6 as R,a7 as Se,a8 as Ue,a9 as V,G as Oe,aa as le,ab as re,F as ie,p as P,ac as Le,ad as K,ae as de,r as H,b as W}from"./index-6058cfe1.js";import{u as Ae,N as je,M as Be}from"./MainLayout-a70f2f10.js";import{C as G,D as Ne,_ as X,p as Pe,a as Te,A as Ee}from"./chart-07e40796.js";const Fe=async()=>{try{return(await Z.get("/api/chats")).data}catch{return new Error("Error fetch chats")}},Re=async t=>{await Z.put(`/api/chats/${t.id}`,t.data)},ue=async(t,e)=>{t.sendTime=_e().format("HH:mm"),(t.text.trim()||t.file.trim())&&(t.chatId=e,O.emit("message",t),t.text="")},ce=async()=>{const t=T();O.on("message",e=>{t.setMessages(e),requestAnimationFrame(()=>{window.scrollTo(0,document.body.scrollHeight)})})},me=async t=>ee.getFileView("676081be001c55b9da7d",t),he=t=>O.emit("join",t),pe=async t=>{try{return await ee.createFile("676081be001c55b9da7d",ye.unique(),t)}catch{return null}},Y=Object.freeze(Object.defineProperty({__proto__:null,createChat:we,deleteChat:Ce,fetchChat:xe,fetchChats:Fe,getFileView:me,getMessages:ce,joinToChat:he,sendMessage:ue,setFileToStorage:pe,updateChat:Re},Symbol.toStringTag,{value:"Module"})),Ve={},Ke={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6 w-12 h-12"};function He(t,e){return d(),v("svg",Ke,e[0]||(e[0]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"},null,-1)]))}const Ze=B(Ve,[["render",He]]),qe={class:"flex flex-col"},ze=["href"],Ge={key:1},Qe={class:"text-xs text-right"},We=$({__name:"Messages",props:{message:{}},setup(t){const{t:e}=N({useScope:"global"}),a=E.getData("id"),l=o=>o!==null?+o:0;return(o,i)=>(d(),v("div",qe,[n("div",{class:be(["bg-default text-white rounded-2xl my-2 p-3 break-words inline-block max-w-xl",{"ml-auto mr-4":l(s(a))===+o.message.userId,"mr-auto ml-4":l(s(a))!==+o.message.userId}])},[o.message.file?(d(),v("a",{key:0,target:"_blank",class:"cursor-pointer",href:o.message.file},[g(Ze)],8,ze)):(d(),v("div",Ge,h(o.message.text),1)),n("div",Qe,h(l(s(a))===+o.message.userId?s(e)("you"):o.message.username)+" "+h(o.message.sendTime),1)],2)]))}}),Xe=t=>{const e=t.split("/"),a=e[e.length-2],l=e[e.length-1];return{id:a,uuid:l}},J=t=>{const{id:e,uuid:a}=Xe(t.route);return he(a),t.getChat(+e),a},Ye=()=>{const t=te();function e(a){a.key==="Escape"&&t.push("/chats")}q(()=>{window.addEventListener("keydown",e)}),Me(()=>{window.removeEventListener("keydown",e)})},Je=t=>(console.log("deleteChatByIndex"),t.chats.filter(e=>e.id!==t.id)),et={},tt={xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 mr-[2px] mt-[2px]",viewBox:"0 0 24 24",fill:"#fff",stroke:"#fff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"};function st(t,e){return d(),v("svg",tt,e[0]||(e[0]=[n("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),n("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)]))}const at=B(et,[["render",st]]),ot=$({__name:"SendMessageButton",emits:["send-message"],setup(t){return(e,a)=>(d(),D(s(A),{onClick:a[0]||(a[0]=l=>e.$emit("send-message")),"is-rounded-full":!0},{default:C(()=>[g(at)]),_:1}))}}),nt={},lt={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"2",stroke:"#fff",class:"w-6 h-6"};function rt(t,e){return d(),v("svg",lt,e[0]||(e[0]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"},null,-1)]))}const it=B(nt,[["render",rt]]),dt=$({__name:"SendFileButton",setup(t){const e=L(""),a=T(),l=async o=>{const i=o.target;if(i.files!==null){const u=await pe(i.files[0]);u&&(e.value=await me(u==null?void 0:u.$id),a.messagesData.file=e.value,console.log("messagesStore.messagesData",a.messagesData),a.messagesData.userId=+a.messagesData.userId,ue(a.messagesData,a.messagesData.chatId))}};return(o,i)=>(d(),D(s($e),{onOnFileChange:l,type:"file",class:"p-2 mr-4 hover:rotate-90 ease-in duration-150"},{default:C(()=>[g(it)]),_:1}))}}),ut={class:"flex justify-center gap-3 mt-4"},ct=$({__name:"ConfirmDeleteChatModal",props:{isOpenModal:{type:Boolean},chatId:{}},emits:["closeModal","deleteCurrentChat"],setup(t){const{t:e}=N({useScope:"global"});return(a,l)=>(d(),D(s(z),{onCloseModal:l[2]||(l[2]=o=>a.$emit("closeModal")),"is-open-modal":a.isOpenModal},{default:C(()=>[n("h3",null,h(s(e)("confirmDelete")),1),n("div",ut,[g(s(A),{onClick:l[0]||(l[0]=o=>a.$emit("deleteCurrentChat",a.chatId)),class:"w-20",color:"primary","is-rounded-lg":!0},{default:C(()=>[S(h(s(e)("yes")),1)]),_:1}),g(s(A),{onClick:l[1]||(l[1]=o=>a.$emit("closeModal")),class:"w-20","is-rounded-lg":!0},{default:C(()=>[S(h(s(e)("no")),1)]),_:1})])]),_:1},8,["is-open-modal"]))}}),mt={},ht={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"#fff",class:"w-10 h-10"};function pt(t,e){return d(),v("svg",ht,e[0]||(e[0]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"},null,-1)]))}const ft=B(mt,[["render",pt]]),gt={class:"fixed top-0 left-[383px] right-0 bg-white h-[70px] px-4 flex justify-between items-center"},vt={class:"flex items-center"},_t={class:"bg-default p-2 rounded-full mr-2"},yt={class:"font-bold text-xl"},wt=$({__name:"ChatHeader",props:{chatName:{}},emits:["openModal"],setup(t){return(e,a)=>(d(),v("header",{onClick:a[0]||(a[0]=l=>e.$emit("openModal")),class:"cursor-pointer mb-20"},[n("div",gt,[n("div",vt,[n("div",_t,[g(ft,{class:"h-8 w-8"})]),n("h1",yt,h(e.chatName),1)])])]))}}),Ct=["placeholder"],xt=$({__name:"SendMessageForm",props:{uuid:{},chatId:{}},setup(t){const e=t,{t:a}=N({useScope:"global"}),l=se(),o=T(),i=String(E.getData("id")),u=ae();return o.setMessagesData({userId:i,chatId:+u.params.id,text:"",sendTime:"",file:"",username:l.username,uuid:e.uuid}),F(e,()=>{o.messagesData.uuid=e.uuid}),ce(),(p,_)=>(d(),v("form",{autocomplete:"off",onSubmit:_[2]||(_[2]=Q(r=>s(Y).sendMessage(s(o).messagesData,p.chatId),["prevent"])),class:"relative bottom-0 mx-0 mb-0 rounded-none md:sticky md:bottom-3 md:mx-4 md:mb-3 md:rounded-2xl flex justify-center items-center bg-white px-6"},[g(s(dt)),oe(n("textarea",De({onKeydown:_[0]||(_[0]=Ie(Q(r=>s(Y).sendMessage(s(o).messagesData,p.chatId),["prevent"]),["enter"]))},p.$attrs,{class:"outline-none border-solid resize-none overflow-hidden w-full pt-5",placeholder:s(a)("writeMessage"),"onUpdate:modelValue":_[1]||(_[1]=r=>s(o).messagesData.text=r)}),null,16,Ct),[[ke,s(o).messagesData.text]]),g(s(ot))],32))}}),fe={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},bt={ariaLabel:{type:String},ariaDescribedby:{type:String}},Mt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...fe,...bt},$t=Se[0]==="2"?(t,e)=>Object.assign(t,{attrs:e}):(t,e)=>Object.assign(t,e);function j(t){return le(t)?V(t):t}function kt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return le(e)?new Proxy(t,{}):t}function Dt(t,e){const a=t.options;a&&e&&Object.assign(a,e)}function ge(t,e){t.labels=e}function ve(t,e,a){const l=[];t.datasets=e.map(o=>{const i=t.datasets.find(u=>u[a]===o[a]);return!i||!o.data||l.includes(i)?{...o}:(l.push(i),Object.assign(i,o),i)})}function It(t,e){const a={labels:[],datasets:[]};return ge(a,t.labels),ve(a,t.datasets,e),a}const St=$({props:Mt,setup(t,e){let{expose:a,slots:l}=e;const o=L(null),i=ne(null);a({chart:i});const u=()=>{if(!o.value)return;const{type:r,data:f,options:x,plugins:I,datasetIdKey:U}=t,c=It(f,U),y=kt(c,f);i.value=new G(o.value,{type:r,data:y,options:{...x},plugins:I})},p=()=>{const r=V(i.value);r&&(t.destroyDelay>0?setTimeout(()=>{r.destroy(),i.value=null},t.destroyDelay):(r.destroy(),i.value=null))},_=r=>{r.update(t.updateMode)};return q(u),Ue(p),F([()=>t.options,()=>t.data],(r,f)=>{let[x,I]=r,[U,c]=f;const y=V(i.value);if(!y)return;let b=!1;if(x){const M=j(x),k=j(U);M&&M!==k&&(Dt(y,M),b=!0)}if(I){const M=j(I.labels),k=j(c.labels),m=j(I.datasets),w=j(c.datasets);M!==k&&(ge(y.config.data,M),b=!0),m&&m!==w&&(ve(y.config.data,m,t.datasetIdKey),b=!0)}b&&Oe(()=>{_(y)})},{deep:!0}),()=>R("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:o},[R("p",{},[l.default?l.default():""])])}});function Ut(t,e){return G.register(e),$({props:fe,setup(a,l){let{expose:o}=l;const i=ne(null),u=p=>{i.value=p==null?void 0:p.chart};return o({chart:i}),()=>R(St,$t({ref:u},{type:t,...a}))}})}const Ot=Ut("doughnut",Ne),Lt={class:"font-bold text-[20px]"},At={class:"flex justify-between"},jt=["value"],Bt=$({__name:"inviteUsers",props:{isOpenAddUser:{type:Boolean},users:{},chatName:{},chatUuid:{},chat:{}},emits:["closeAddUser"],setup(t){const{t:e}=N({useScope:"global"}),a=t,l=L([]),o=L(!1),i=L(!1),u=()=>{l.value.length?(l.value.forEach(p=>{O.emit("personalInvite",p),O.emit("messageInvite",{uuidRoom:a.chat.uuid,titleRoom:a.chat.roomName,roomId:a.chat.id,userUuid:p}),O.emit("personalInvite",E.getData("uuid"))}),l.value.length=0,i.value=!0):o.value=!0};return(p,_)=>(d(),D(s(z),{class:"w-[440px]",onCloseModal:_[1]||(_[1]=r=>p.$emit("closeAddUser")),"is-open-modal":p.isOpenAddUser},{default:C(()=>[n("ul",null,[n("p",Lt,h(s(e)("selectUser")),1),(d(!0),v(ie,null,re(p.users,r=>(d(),v("li",{class:"mt-4",key:r.id},[n("div",At,[S(h(r.name)+" "+h(r.surname)+" ",1),oe(n("input",{type:"checkbox",value:r.uuid,"onUpdate:modelValue":_[0]||(_[0]=f=>l.value=f)},null,8,jt),[[Le,l.value]])])]))),128))]),g(s(A),{onClick:u,class:"mt-7 w-full","is-rounded-lg":!0},{default:C(()=>[S(h(s(e)("add")),1)]),_:1}),o.value?(d(),D(s(X),{key:0,class:"text-center mt-2","type-toast":"error"},{default:C(()=>[S(h(s(e)("inviteError")),1)]),_:1})):P("",!0),i.value?(d(),D(s(X),{key:1,class:"text-center mt-2","type-toast":"success"},{default:C(()=>[S(h(s(e)("inviteSuccess")),1)]),_:1})):P("",!0)]),_:1},8,["is-open-modal"]))}}),Nt={},Pt={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 w-6"};function Tt(t,e){return d(),v("svg",Pt,e[0]||(e[0]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"},null,-1)]))}const Et=B(Nt,[["render",Tt]]),Ft={class:"flex flex-col h-full"},Rt={class:"text-3xl font-bold"},Vt={class:"mt-4"},Kt={key:0,class:"mt-12"},Ht={class:"text-2xl"},Zt={class:"mt-4 grid grid-cols-3 gap-1"},qt={key:1},zt={class:"mt-4"},Gt={key:0,class:"mt-auto ml-auto flex gap-2"},Qt=$({__name:"AnalysisChat",props:{chat:{}},emits:["closeModal"],setup(t){const{t:e}=N({useScope:"global"}),a=t,{isOpenModal:l,closeModal:o,openModal:i}=K(),{isOpenModal:u,closeModal:p,openModal:_}=K(),r=E.getData("id"),f=de(),x=se();x.getUsers();const I=te(),U=m=>{f.removeChat(m),Je({chats:x.user.chats,id:m}),x.getUser(r!==null?+r:0),o(),I.push("/chats")},c=H({fileLength:0,textLength:0});G.register(Pe,Te,Ee);const y=async()=>{try{const m=(await Z.post(`/api/analise/${a.chat.id}`)).data;c.fileLength=m.fileLength,c.textLength=m.textLength}catch{return new Error("Error fetching chat")}};q(()=>{y()}),console.log(c);const b=L({labels:[e("textMessage"),e("files")],datasets:[{backgroundColor:["#242424","#bc0ce8"],data:[c.textLength,c.fileLength]}]}),M={responsive:!0,maintainAspectRatio:!1},k=L(0);return F(()=>[c.textLength,c.fileLength],([m,w])=>{b.value.datasets[0].data=[m,w],k.value+=1}),(m,w)=>(d(),v("section",Ft,[n("div",null,[n("h1",Rt,h(m.chat.roomName),1),n("p",Vt,h(m.chat.description),1),c.textLength?(d(),v("div",Kt,[n("h2",Ht,h(s(e)("analiseChat"))+":",1),n("div",Zt,[n("div",null,[(d(),D(s(Ot),{class:"chart",options:M,data:b.value,key:k.value},null,8,["data"]))]),n("table",null,[w[3]||(w[3]=n("thead",null,[n("tr",null,[n("th",null,"Категории"),n("th",null,"Количество")])],-1)),n("tbody",null,[n("tr",null,[w[1]||(w[1]=n("td",null,"Текстовые сообщения",-1)),n("td",null,h(c.textLength),1)]),n("tr",null,[w[2]||(w[2]=n("td",null,"Файловые сообщения",-1)),n("td",null,h(c.fileLength),1)])])])])])):(d(),v("div",qt,"Статистики пока нету")),w[4]||(w[4]=n("div",{class:"h-[0.5px] mt-4 bg-slate-400"},null,-1)),n("div",zt,[s(r)&&+s(r)===m.chat.userId?(d(),D(s(A),{key:0,onClick:s(_),class:"gap-2","is-rounded-lg":!0},{default:C(()=>[S(h(s(e)("inviteUsers"))+" ",1),g(Et)]),_:1},8,["onClick"])):P("",!0)])]),s(r)&&+s(r)===m.chat.userId?(d(),v("div",Gt,[g(s(A),{onClick:w[0]||(w[0]=Jt=>m.$emit("closeModal")),class:"w-32",color:"primary","is-rounded-lg":!0},{default:C(()=>[S(h(s(e)("close")),1)]),_:1}),g(s(A),{onClick:s(i),class:"w-32",color:"danger","is-rounded-lg":!0},{default:C(()=>[S(h(s(e)("deleteChat")),1)]),_:1},8,["onClick"])])):P("",!0),g(s(ct),{"is-open-modal":s(l),chatId:m.chat.id,onCloseModal:s(o),onDeleteCurrentChat:U},null,8,["is-open-modal","chatId","onCloseModal"]),g(s(Bt),{"is-open-add-user":s(u),users:s(x).users,chatName:m.chat.roomName,chatUuid:m.chat.uuid,chat:m.chat,onCloseAddUser:s(p)},null,8,["is-open-add-user","users","chatName","chatUuid","chat","onCloseAddUser"])]))}});const Wt=B(Qt,[["__scopeId","data-v-0ba77435"]]),Xt={key:0,class:"flex flex-col justify-between min-h-screen"},Yt={key:1,class:"flex flex-col justify-center items-center min-h-screen"},as=$({__name:"Chat",setup(t){Ye();const e=ae(),{isOpenModal:a,closeModal:l,openModal:o}=K(),i=T(),u=de(),p=H({route:e.fullPath,getChat:u.getChat});let _=J(p);F(e,()=>{_=J({route:e.fullPath,getChat:u.getChat})});const r=L(!1),f=H({title:"",uuid:"",userUuid:!1,roomId:null}),x=()=>r.value=!1;O.emit("personalInvite",W.get("uuid")),O.on("messageInvite",async(U,c,y,b)=>{f.title=c,f.uuid=U,f.roomId=b,f.userUuid=y===W.get("uuid"),f.title&&f.uuid&&f.userUuid&&(r.value=!0,setTimeout(()=>r.value=!1,5e3))});const{enterChat:I}=Ae();return(U,c)=>(d(),D(s(Be),null,{default:C(()=>{var y,b,M;return[(y=s(u))!=null&&y.chat?(d(),v("div",Xt,[g(s(wt),{onOpenModal:s(o),"chat-name":(M=(b=s(u))==null?void 0:b.chat)==null?void 0:M.roomName},null,8,["onOpenModal","chat-name"]),n("div",null,[(d(!0),v(ie,null,re(s(i).getMessages(s(u).chat.messages),k=>(d(),D(s(We),{key:k.userId,message:k},null,8,["message"]))),128)),g(s(xt),{"chat-id":s(u).chat.id,uuid:s(_)},null,8,["chat-id","uuid"])])])):(d(),v("div",Yt,c[1]||(c[1]=[n("p",{class:"text-white bg-black p-2 rounded-xl"},"Чата был удален",-1)]))),g(s(z),{class:"w-[900px] h-[800px]",onCloseModal:s(l),"is-open-modal":s(a)},{default:C(()=>[g(s(Wt),{onCloseModal:s(l),chat:s(u).chat},null,8,["onCloseModal","chat"])]),_:1},8,["onCloseModal","is-open-modal"]),g(s(je),{"is-invite-room":r.value,chatTitle:f.title,onEnterChat:c[0]||(c[0]=k=>s(I)(f.uuid,f.title,f.roomId,x)),onCloseNotification:x},null,8,["is-invite-room","chatTitle"])]}),_:1}))}});export{as as default};
