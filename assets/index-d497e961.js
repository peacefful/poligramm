import{h as Z,T as _e,R as O,U as T,V as ee,W as ye,X as we,Y as Ce,Z as xe,_ as B,o as d,n as v,m as i,d as M,c as N,s as E,k as g,t as f,l as s,$ as be,u as te,z as q,E as Me,j as k,w,P as L,e as A,a0 as $e,q as I,a1 as z,a2 as se,a3 as ae,D as F,L as oe,a4 as ke,N as De,a5 as Ie,Q,K as ne,a6 as R,a7 as Se,a8 as Ue,a9 as V,G as Oe,aa as re,ab as le,F as ie,p as P,ac as Ae,ad as K,ae as de,r as H,b as W}from"./index-03a7bd60.js";import{u as Le,N as je,M as Be}from"./MainLayout-bca1ef30.js";import{C as G,D as Ne,_ as X,p as Pe,a as Te,A as Ee}from"./chart-ab8f6112.js";const Fe=async()=>{try{return(await Z.get("/api/chats")).data}catch{return new Error("Error fetch chats")}},Re=async t=>{await Z.put(`/api/chats/${t.id}`,t.data)},ce=async(t,e)=>{t.sendTime=_e().format("HH:mm"),(t.text.trim()||t.file.trim())&&(t.chatId=e,O.emit("message",t),t.text="")},ue=async()=>{const t=T();O.on("message",e=>{t.setMessages(e),requestAnimationFrame(()=>{window.scrollTo(0,document.body.scrollHeight)})})},me=async t=>ee.getFileView("676081be001c55b9da7d",t),he=t=>O.emit("join",t),pe=async t=>{try{return await ee.createFile("676081be001c55b9da7d",ye.unique(),t)}catch{return null}},Y=Object.freeze(Object.defineProperty({__proto__:null,createChat:we,deleteChat:Ce,fetchChat:xe,fetchChats:Fe,getFileView:me,getMessages:ue,joinToChat:he,sendMessage:ce,setFileToStorage:pe,updateChat:Re},Symbol.toStringTag,{value:"Module"})),Ve={},Ke={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6 w-12 h-12"};function He(t,e){return d(),v("svg",Ke,e[0]||(e[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"},null,-1)]))}const Ze=B(Ve,[["render",He]]),qe={class:"flex flex-col"},ze=["href"],Ge={key:1},Qe={class:"text-xs text-right"},We=M({__name:"Messages",props:{message:{}},setup(t){const{t:e}=N({useScope:"global"}),a=E.getData("id"),n=o=>o!==null?+o:0;return(o,l)=>(d(),v("div",qe,[i("div",{class:be(["bg-default text-white rounded-2xl my-2 p-3 break-words inline-block max-w-xl",{"ml-auto mr-4":n(s(a))===+o.message.userId,"mr-auto ml-4":n(s(a))!==+o.message.userId}])},[o.message.file?(d(),v("a",{key:0,target:"_blank",class:"cursor-pointer",href:o.message.file},[g(Ze)],8,ze)):(d(),v("div",Ge,f(o.message.text),1)),i("div",Qe,f(n(s(a))===+o.message.userId?s(e)("you"):o.message.username)+" "+f(o.message.sendTime),1)],2)]))}}),Xe=t=>{const e=t.split("/"),a=e[e.length-2],n=e[e.length-1];return{id:a,uuid:n}},J=t=>{const{id:e,uuid:a}=Xe(t.route);return he(a),t.getChat(+e),a},Ye=()=>{const t=te();function e(a){a.key==="Escape"&&t.push("/chats")}q(()=>{window.addEventListener("keydown",e)}),Me(()=>{window.removeEventListener("keydown",e)})},Je=t=>(console.log("deleteChatByIndex"),t.chats.filter(e=>e.id!==t.id)),et={},tt={xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 mr-[2px] mt-[2px]",viewBox:"0 0 24 24",fill:"#fff",stroke:"#fff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"};function st(t,e){return d(),v("svg",tt,e[0]||(e[0]=[i("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),i("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)]))}const at=B(et,[["render",st]]),ot=M({__name:"SendMessageButton",emits:["send-message"],setup(t){return(e,a)=>(d(),k(s(L),{onClick:a[0]||(a[0]=n=>e.$emit("send-message")),"is-rounded-full":!0},{default:w(()=>[g(at)]),_:1}))}}),nt={},rt={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"2",stroke:"#fff",class:"w-6 h-6"};function lt(t,e){return d(),v("svg",rt,e[0]||(e[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"},null,-1)]))}const it=B(nt,[["render",lt]]),dt=M({__name:"SendFileButton",setup(t){const e=A(""),a=T(),n=async o=>{const l=o.target;if(l.files!==null){const c=await pe(l.files[0]);c&&(e.value=await me(c==null?void 0:c.$id),a.messagesData.file=e.value,console.log("messagesStore.messagesData",a.messagesData),a.messagesData.userId=+a.messagesData.userId,ce(a.messagesData,a.messagesData.chatId))}};return(o,l)=>(d(),k(s($e),{onOnFileChange:n,type:"file",class:"p-2 mr-4 hover:rotate-90 ease-in duration-150"},{default:w(()=>[g(it)]),_:1}))}}),ct={class:"flex justify-center gap-3 mt-4"},ut=M({__name:"ConfirmDeleteChatModal",props:{isOpenModal:{type:Boolean},chatId:{}},emits:["closeModal","deleteCurrentChat"],setup(t){const{t:e}=N({useScope:"global"});return(a,n)=>(d(),k(s(z),{onCloseModal:n[2]||(n[2]=o=>a.$emit("closeModal")),"is-open-modal":a.isOpenModal},{default:w(()=>[i("h3",null,f(s(e)("confirmDelete")),1),i("div",ct,[g(s(L),{onClick:n[0]||(n[0]=o=>a.$emit("deleteCurrentChat",a.chatId)),class:"w-20",color:"primary","is-rounded-lg":!0},{default:w(()=>[I(f(s(e)("yes")),1)]),_:1}),g(s(L),{onClick:n[1]||(n[1]=o=>a.$emit("closeModal")),class:"w-20","is-rounded-lg":!0},{default:w(()=>[I(f(s(e)("no")),1)]),_:1})])]),_:1},8,["is-open-modal"]))}}),mt={},ht={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"#fff",class:"w-10 h-10"};function pt(t,e){return d(),v("svg",ht,e[0]||(e[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"},null,-1)]))}const ft=B(mt,[["render",pt]]),gt={class:"fixed top-0 left-[383px] right-0 bg-white h-[70px] px-4 flex justify-between items-center"},vt={class:"flex items-center"},_t={class:"bg-default p-2 rounded-full mr-2"},yt={class:"font-bold text-xl"},wt=M({__name:"ChatHeader",props:{chatName:{}},emits:["openModal"],setup(t){return(e,a)=>(d(),v("header",{onClick:a[0]||(a[0]=n=>e.$emit("openModal")),class:"cursor-pointer mb-20"},[i("div",gt,[i("div",vt,[i("div",_t,[g(ft,{class:"h-8 w-8"})]),i("h1",yt,f(e.chatName),1)])])]))}}),Ct=["placeholder"],xt=M({__name:"SendMessageForm",props:{uuid:{},chatId:{}},setup(t){const e=t,{t:a}=N({useScope:"global"}),n=se(),o=T(),l=String(E.getData("id")),c=ae();return o.setMessagesData({userId:l,chatId:+c.params.id,text:"",sendTime:"",file:"",username:n.username,uuid:e.uuid}),F(e,()=>{o.messagesData.uuid=e.uuid}),ue(),(m,_)=>(d(),v("form",{autocomplete:"off",onSubmit:_[2]||(_[2]=Q(r=>s(Y).sendMessage(s(o).messagesData,m.chatId),["prevent"])),class:"relative bottom-0 mx-0 mb-0 rounded-none md:sticky md:bottom-3 md:mx-4 md:mb-3 md:rounded-2xl flex justify-center items-center bg-white px-6"},[g(s(dt)),oe(i("textarea",De({onKeydown:_[0]||(_[0]=Ie(Q(r=>s(Y).sendMessage(s(o).messagesData,m.chatId),["prevent"]),["enter"]))},m.$attrs,{class:"outline-none border-solid resize-none overflow-hidden w-full pt-5",placeholder:s(a)("writeMessage"),"onUpdate:modelValue":_[1]||(_[1]=r=>s(o).messagesData.text=r)}),null,16,Ct),[[ke,s(o).messagesData.text]]),g(s(ot))],32))}}),fe={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},bt={ariaLabel:{type:String},ariaDescribedby:{type:String}},Mt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...fe,...bt},$t=Se[0]==="2"?(t,e)=>Object.assign(t,{attrs:e}):(t,e)=>Object.assign(t,e);function j(t){return re(t)?V(t):t}function kt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return re(e)?new Proxy(t,{}):t}function Dt(t,e){const a=t.options;a&&e&&Object.assign(a,e)}function ge(t,e){t.labels=e}function ve(t,e,a){const n=[];t.datasets=e.map(o=>{const l=t.datasets.find(c=>c[a]===o[a]);return!l||!o.data||n.includes(l)?{...o}:(n.push(l),Object.assign(l,o),l)})}function It(t,e){const a={labels:[],datasets:[]};return ge(a,t.labels),ve(a,t.datasets,e),a}const St=M({props:Mt,setup(t,e){let{expose:a,slots:n}=e;const o=A(null),l=ne(null);a({chart:l});const c=()=>{if(!o.value)return;const{type:r,data:h,options:C,plugins:D,datasetIdKey:S}=t,p=It(h,S),y=kt(p,h);l.value=new G(o.value,{type:r,data:y,options:{...C},plugins:D})},m=()=>{const r=V(l.value);r&&(t.destroyDelay>0?setTimeout(()=>{r.destroy(),l.value=null},t.destroyDelay):(r.destroy(),l.value=null))},_=r=>{r.update(t.updateMode)};return q(c),Ue(m),F([()=>t.options,()=>t.data],(r,h)=>{let[C,D]=r,[S,p]=h;const y=V(l.value);if(!y)return;let x=!1;if(C){const b=j(C),$=j(S);b&&b!==$&&(Dt(y,b),x=!0)}if(D){const b=j(D.labels),$=j(p.labels),u=j(D.datasets),U=j(p.datasets);b!==$&&(ge(y.config.data,b),x=!0),u&&u!==U&&(ve(y.config.data,u,t.datasetIdKey),x=!0)}x&&Oe(()=>{_(y)})},{deep:!0}),()=>R("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:o},[R("p",{},[n.default?n.default():""])])}});function Ut(t,e){return G.register(e),M({props:fe,setup(a,n){let{expose:o}=n;const l=ne(null),c=m=>{l.value=m==null?void 0:m.chart};return o({chart:l}),()=>R(St,$t({ref:c},{type:t,...a}))}})}const Ot=Ut("doughnut",Ne),At={class:"font-bold text-[20px]"},Lt={class:"flex justify-between"},jt=["value"],Bt=M({__name:"inviteUsers",props:{isOpenAddUser:{type:Boolean},users:{},chatName:{},chatUuid:{},chat:{}},emits:["closeAddUser"],setup(t){const{t:e}=N({useScope:"global"}),a=t,n=A([]),o=A(!1),l=A(!1),c=()=>{n.value.length?(n.value.forEach(m=>{O.emit("personalInvite",m),O.emit("messageInvite",{uuidRoom:a.chat.uuid,titleRoom:a.chat.roomName,roomId:a.chat.id,userUuid:m}),O.emit("personalInvite",E.getData("uuid"))}),n.value.length=0,l.value=!0):o.value=!0};return(m,_)=>(d(),k(s(z),{class:"w-[440px]",onCloseModal:_[1]||(_[1]=r=>m.$emit("closeAddUser")),"is-open-modal":m.isOpenAddUser},{default:w(()=>[i("ul",null,[i("p",At,f(s(e)("selectUser")),1),(d(!0),v(ie,null,le(m.users,r=>(d(),v("li",{class:"mt-4",key:r.id},[i("div",Lt,[I(f(r.name)+" "+f(r.surname)+" ",1),oe(i("input",{type:"checkbox",value:r.uuid,"onUpdate:modelValue":_[0]||(_[0]=h=>n.value=h)},null,8,jt),[[Ae,n.value]])])]))),128))]),g(s(L),{onClick:c,class:"mt-7 w-full","is-rounded-lg":!0},{default:w(()=>[I(f(s(e)("add")),1)]),_:1}),o.value?(d(),k(s(X),{key:0,class:"text-center mt-2","type-toast":"error"},{default:w(()=>[I(f(s(e)("inviteError")),1)]),_:1})):P("",!0),l.value?(d(),k(s(X),{key:1,class:"text-center mt-2","type-toast":"success"},{default:w(()=>[I(f(s(e)("inviteSuccess")),1)]),_:1})):P("",!0)]),_:1},8,["is-open-modal"]))}}),Nt={},Pt={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 w-6"};function Tt(t,e){return d(),v("svg",Pt,e[0]||(e[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"},null,-1)]))}const Et=B(Nt,[["render",Tt]]),Ft={class:"flex flex-col h-full"},Rt={class:"text-3xl font-bold"},Vt={class:"mt-4"},Kt={key:0,class:"mt-12"},Ht={class:"text-2xl"},Zt={class:"mt-4 grid grid-cols-3 gap-1"},qt={key:1},zt={class:"mt-4"},Gt={key:0,class:"mt-auto ml-auto flex gap-2"},Qt=M({__name:"AnalysisChat",props:{chat:{}},emits:["closeModal"],setup(t){const{t:e}=N({useScope:"global"}),a=t,{isOpenModal:n,closeModal:o,openModal:l}=K(),{isOpenModal:c,closeModal:m,openModal:_}=K(),r=E.getData("id"),h=de(),C=se();C.getUsers();const D=te(),S=u=>{h.removeChat(u),Je({chats:C.user.chats,id:u}),C.getUser(r!==null?+r:0),o(),D.push("/chats")},p=H({fileLength:0,textLength:0});G.register(Pe,Te,Ee);const y=async()=>{try{const u=(await Z.post(`/api/analise/${a.chat.id}`)).data;p.fileLength=u.fileLength,p.textLength=u.textLength}catch{return new Error("Error fetching chat")}};q(()=>{y()}),console.log(p);const x=A({labels:[e("textMessage"),e("files")],datasets:[{backgroundColor:["#242424","#bc0ce8"],data:[p.textLength,p.fileLength]}]}),b={responsive:!0,maintainAspectRatio:!1},$=A(0);return F(()=>[p.textLength,p.fileLength],([u,U])=>{x.value.datasets[0].data=[u,U],$.value+=1}),(u,U)=>(d(),v("section",Ft,[i("div",null,[i("h1",Rt,f(u.chat.roomName),1),i("p",Vt,f(u.chat.description),1),p.textLength?(d(),v("div",Kt,[i("h2",Ht,f(s(e)("analiseChat"))+":",1),i("div",Zt,[i("div",null,[(d(),k(s(Ot),{class:"chart",options:b,data:x.value,key:$.value},null,8,["data"]))])])])):(d(),v("div",qt,"Статистики пока нету")),U[1]||(U[1]=i("div",{class:"h-[0.5px] mt-4 bg-slate-400"},null,-1)),i("div",zt,[s(r)&&+s(r)===u.chat.userId?(d(),k(s(L),{key:0,onClick:s(_),class:"gap-2","is-rounded-lg":!0},{default:w(()=>[I(f(s(e)("inviteUsers"))+" ",1),g(Et)]),_:1},8,["onClick"])):P("",!0)])]),s(r)&&+s(r)===u.chat.userId?(d(),v("div",Gt,[g(s(L),{onClick:U[0]||(U[0]=Jt=>u.$emit("closeModal")),class:"w-32",color:"primary","is-rounded-lg":!0},{default:w(()=>[I(f(s(e)("close")),1)]),_:1}),g(s(L),{onClick:s(l),class:"w-32",color:"danger","is-rounded-lg":!0},{default:w(()=>[I(f(s(e)("deleteChat")),1)]),_:1},8,["onClick"])])):P("",!0),g(s(ut),{"is-open-modal":s(n),chatId:u.chat.id,onCloseModal:s(o),onDeleteCurrentChat:S},null,8,["is-open-modal","chatId","onCloseModal"]),g(s(Bt),{"is-open-add-user":s(c),users:s(C).users,chatName:u.chat.roomName,chatUuid:u.chat.uuid,chat:u.chat,onCloseAddUser:s(m)},null,8,["is-open-add-user","users","chatName","chatUuid","chat","onCloseAddUser"])]))}});const Wt=B(Qt,[["__scopeId","data-v-462b9a62"]]),Xt={key:0,class:"flex flex-col justify-between min-h-screen"},Yt={key:1,class:"flex flex-col justify-center items-center min-h-screen"},as=M({__name:"Chat",setup(t){Ye();const e=ae(),{isOpenModal:a,closeModal:n,openModal:o}=K(),l=T(),c=de(),m=H({route:e.fullPath,getChat:c.getChat});let _=J(m);F(e,()=>{_=J({route:e.fullPath,getChat:c.getChat})});const r=A(!1),h=H({title:"",uuid:"",userUuid:!1,roomId:null}),C=()=>r.value=!1;O.emit("personalInvite",W.get("uuid")),O.on("messageInvite",async(S,p,y,x)=>{h.title=p,h.uuid=S,h.roomId=x,h.userUuid=y===W.get("uuid"),h.title&&h.uuid&&h.userUuid&&(r.value=!0,setTimeout(()=>r.value=!1,5e3))});const{enterChat:D}=Le();return(S,p)=>(d(),k(s(Be),null,{default:w(()=>{var y,x,b;return[(y=s(c))!=null&&y.chat?(d(),v("div",Xt,[g(s(wt),{onOpenModal:s(o),"chat-name":(b=(x=s(c))==null?void 0:x.chat)==null?void 0:b.roomName},null,8,["onOpenModal","chat-name"]),i("div",null,[(d(!0),v(ie,null,le(s(l).getMessages(s(c).chat.messages),$=>(d(),k(s(We),{key:$.userId,message:$},null,8,["message"]))),128)),g(s(xt),{"chat-id":s(c).chat.id,uuid:s(_)},null,8,["chat-id","uuid"])])])):(d(),v("div",Yt,p[1]||(p[1]=[i("p",{class:"text-white bg-black p-2 rounded-xl"},"Чата был удален",-1)]))),g(s(z),{class:"w-[900px] h-[800px]",onCloseModal:s(n),"is-open-modal":s(a)},{default:w(()=>[g(s(Wt),{onCloseModal:s(n),chat:s(c).chat},null,8,["onCloseModal","chat"])]),_:1},8,["onCloseModal","is-open-modal"]),g(s(je),{"is-invite-room":r.value,chatTitle:h.title,onEnterChat:p[0]||(p[0]=$=>s(D)(h.uuid,h.title,h.roomId,C)),onCloseNotification:C},null,8,["is-invite-room","chatTitle"])]}),_:1}))}});export{as as default};
