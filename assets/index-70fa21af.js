import{h as q,T as ve,R as O,U as T,V as ee,W as _e,X as ye,Y as Ce,Z as we,_ as N,o as i,n as v,m as l,d as $,c as P,s as E,k as g,t as f,l as s,$ as xe,u as te,z,E as be,j as k,w as C,P as L,e as A,a0 as $e,q as D,a1 as Z,a2 as Me,a3 as se,D as F,L as ae,a4 as ke,N as Ie,a5 as De,Q,K as oe,a6 as R,a7 as Se,a8 as Ue,a9 as V,G as Oe,aa as ne,ab as re,F as le,p as B,ac as Ae,ad as K,ae as ie,r as H,af as Le,b as W}from"./index-fe7542b4.js";import{u as je,N as Ne,M as Pe}from"./MainLayout-e221284d.js";import{C as G,D as Be,_ as X,p as Te,a as Ee,A as Fe}from"./chart-32432e2f.js";const Re=async()=>{try{return(await q.get("/api/chats")).data}catch{return new Error("Error fetch chats")}},Ve=async t=>{await q.put(`/api/chats/${t.id}`,t.data)},de=async(t,e)=>{t.sendTime=ve().format("HH:mm"),(t.text.trim()||t.file.trim())&&(t.chatId=e,O.emit("message",t),t.text="")},ue=async()=>{const t=T();O.on("message",e=>{t.setMessages(e),requestAnimationFrame(()=>{window.scrollTo(0,document.body.scrollHeight)})})},ce=async t=>ee.getFileView("676081be001c55b9da7d",t),me=t=>O.emit("join",t),he=async t=>{try{return await ee.createFile("676081be001c55b9da7d",_e.unique(),t)}catch{return null}},Y=Object.freeze(Object.defineProperty({__proto__:null,createChat:ye,deleteChat:Ce,fetchChat:we,fetchChats:Re,getFileView:ce,getMessages:ue,joinToChat:me,sendMessage:de,setFileToStorage:he,updateChat:Ve},Symbol.toStringTag,{value:"Module"})),Ke={},He={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6 w-12 h-12"};function qe(t,e){return i(),v("svg",He,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"},null,-1)]))}const ze=N(Ke,[["render",qe]]),Ze={class:"flex flex-col"},Ge=["href"],Qe={key:1},We={class:"text-xs text-right"},Xe=$({__name:"Messages",props:{message:{}},setup(t){const{t:e}=P({useScope:"global"}),a=E.getData("id"),n=o=>o!==null?+o:0;return(o,r)=>(i(),v("div",Ze,[l("div",{class:xe(["bg-default text-white rounded-2xl my-2 p-3 break-words inline-block max-w-xl",{"ml-auto mr-4":n(s(a))===+o.message.userId,"mr-auto ml-4":n(s(a))!==+o.message.userId}])},[o.message.file?(i(),v("a",{key:0,target:"_blank",class:"cursor-pointer",href:o.message.file},[g(ze)],8,Ge)):(i(),v("div",Qe,f(o.message.text),1)),l("div",We,f(n(s(a))===+o.message.userId?s(e)("you"):o.message.username)+" "+f(o.message.sendTime),1)],2)]))}}),Ye=t=>{const e=t.split("/"),a=e[e.length-2],n=e[e.length-1];return{id:a,uuid:n}},J=t=>{const{id:e,uuid:a}=Ye(t.route);return me(a),t.getChat(+e),a},Je=()=>{const t=te();function e(a){a.key==="Escape"&&t.push("/chats")}z(()=>{window.addEventListener("keydown",e)}),be(()=>{window.removeEventListener("keydown",e)})},et=t=>(console.log("deleteChatByIndex"),t.chats.filter(e=>e.id!==t.id)),tt={},st={xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 mr-[2px] mt-[2px]",viewBox:"0 0 24 24",fill:"#fff",stroke:"#fff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"};function at(t,e){return i(),v("svg",st,e[0]||(e[0]=[l("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),l("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)]))}const ot=N(tt,[["render",at]]),nt=$({__name:"SendMessageButton",emits:["send-message"],setup(t){return(e,a)=>(i(),k(s(L),{onClick:a[0]||(a[0]=n=>e.$emit("send-message")),"is-rounded-full":!0},{default:C(()=>[g(ot)]),_:1}))}}),rt={},lt={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"2",stroke:"#fff",class:"w-6 h-6"};function it(t,e){return i(),v("svg",lt,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"},null,-1)]))}const dt=N(rt,[["render",it]]),ut=$({__name:"SendFileButton",setup(t){const e=A(""),a=T(),n=async o=>{const r=o.target;if(r.files!==null){const u=await he(r.files[0]);u&&(e.value=await ce(u==null?void 0:u.$id),a.messagesData.file=e.value,a.messagesData.userId=+a.messagesData.userId,de(a.messagesData,a.messagesData.chatId))}};return(o,r)=>(i(),k(s($e),{onOnFileChange:n,type:"file",class:"p-2 mr-4 hover:rotate-90 ease-in duration-150"},{default:C(()=>[g(dt)]),_:1}))}}),ct={class:"flex justify-center gap-3 mt-4"},mt=$({__name:"ConfirmDeleteChatModal",props:{isOpenModal:{type:Boolean},chatId:{}},emits:["closeModal","deleteCurrentChat"],setup(t){const{t:e}=P({useScope:"global"});return(a,n)=>(i(),k(s(Z),{onCloseModal:n[2]||(n[2]=o=>a.$emit("closeModal")),"is-open-modal":a.isOpenModal},{default:C(()=>[l("h3",null,f(s(e)("confirmDelete")),1),l("div",ct,[g(s(L),{onClick:n[0]||(n[0]=o=>a.$emit("deleteCurrentChat",a.chatId)),class:"w-20",color:"primary","is-rounded-lg":!0},{default:C(()=>[D(f(s(e)("yes")),1)]),_:1}),g(s(L),{onClick:n[1]||(n[1]=o=>a.$emit("closeModal")),class:"w-20","is-rounded-lg":!0},{default:C(()=>[D(f(s(e)("no")),1)]),_:1})])]),_:1},8,["is-open-modal"]))}}),ht={class:"fixed top-0 left-[383px] right-0 bg-white h-[70px] px-4 flex justify-between items-center"},pt={class:"flex items-center"},ft={class:"bg-default p-2 rounded-full mr-2"},gt={class:"font-bold text-xl"},vt=$({__name:"ChatHeader",props:{chatName:{}},emits:["openModal"],setup(t){return(e,a)=>(i(),v("header",{onClick:a[0]||(a[0]=n=>e.$emit("openModal")),class:"cursor-pointer mb-20"},[l("div",ht,[l("div",pt,[l("div",ft,[g(s(Me),{class:"h-8 w-8",name:"usersGroup"})]),l("h1",gt,f(e.chatName),1)])])]))}}),_t=["placeholder"],yt=$({__name:"SendMessageForm",props:{uuid:{},chatId:{}},setup(t){const e=t,{t:a}=P({useScope:"global"}),n=se(),o=T(),r=String(E.getData("id"));return o.setMessagesData({userId:r,chatId:e.chatId,text:"",sendTime:"",file:"",username:n.username,uuid:e.uuid}),F(e,()=>{o.messagesData.uuid=e.uuid}),ue(),(u,c)=>(i(),v("form",{autocomplete:"off",onSubmit:c[2]||(c[2]=Q(_=>s(Y).sendMessage(s(o).messagesData,u.chatId),["prevent"])),class:"relative bottom-0 mx-0 mb-0 rounded-none md:sticky md:bottom-3 md:mx-4 md:mb-3 md:rounded-2xl flex justify-center items-center bg-white px-6"},[g(s(ut)),ae(l("textarea",Ie({onKeydown:c[0]||(c[0]=De(Q(_=>s(Y).sendMessage(s(o).messagesData,u.chatId),["prevent"]),["enter"]))},u.$attrs,{class:"outline-none border-solid resize-none overflow-hidden w-full pt-5",placeholder:s(a)("writeMessage"),"onUpdate:modelValue":c[1]||(c[1]=_=>s(o).messagesData.text=_)}),null,16,_t),[[ke,s(o).messagesData.text]]),g(s(nt))],32))}}),pe={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},Ct={ariaLabel:{type:String},ariaDescribedby:{type:String}},wt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...pe,...Ct},xt=Se[0]==="2"?(t,e)=>Object.assign(t,{attrs:e}):(t,e)=>Object.assign(t,e);function j(t){return ne(t)?V(t):t}function bt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return ne(e)?new Proxy(t,{}):t}function $t(t,e){const a=t.options;a&&e&&Object.assign(a,e)}function fe(t,e){t.labels=e}function ge(t,e,a){const n=[];t.datasets=e.map(o=>{const r=t.datasets.find(u=>u[a]===o[a]);return!r||!o.data||n.includes(r)?{...o}:(n.push(r),Object.assign(r,o),r)})}function Mt(t,e){const a={labels:[],datasets:[]};return fe(a,t.labels),ge(a,t.datasets,e),a}const kt=$({props:wt,setup(t,e){let{expose:a,slots:n}=e;const o=A(null),r=oe(null);a({chart:r});const u=()=>{if(!o.value)return;const{type:d,data:h,options:w,plugins:I,datasetIdKey:S}=t,p=Mt(h,S),y=bt(p,h);r.value=new G(o.value,{type:d,data:y,options:{...w},plugins:I})},c=()=>{const d=V(r.value);d&&(t.destroyDelay>0?setTimeout(()=>{d.destroy(),r.value=null},t.destroyDelay):(d.destroy(),r.value=null))},_=d=>{d.update(t.updateMode)};return z(u),Ue(c),F([()=>t.options,()=>t.data],(d,h)=>{let[w,I]=d,[S,p]=h;const y=V(r.value);if(!y)return;let x=!1;if(w){const b=j(w),M=j(S);b&&b!==M&&($t(y,b),x=!0)}if(I){const b=j(I.labels),M=j(p.labels),m=j(I.datasets),U=j(p.datasets);b!==M&&(fe(y.config.data,b),x=!0),m&&m!==U&&(ge(y.config.data,m,t.datasetIdKey),x=!0)}x&&Oe(()=>{_(y)})},{deep:!0}),()=>R("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:o},[R("p",{},[n.default?n.default():""])])}});function It(t,e){return G.register(e),$({props:pe,setup(a,n){let{expose:o}=n;const r=oe(null),u=c=>{r.value=c==null?void 0:c.chart};return o({chart:r}),()=>R(kt,xt({ref:u},{type:t,...a}))}})}const Dt=It("doughnut",Be),St={class:"font-bold text-[20px]"},Ut={class:"flex justify-between"},Ot=["value"],At=$({__name:"inviteUsers",props:{isOpenAddUser:{type:Boolean},users:{},chatName:{},chatUuid:{},chat:{}},emits:["closeAddUser"],setup(t){const{t:e}=P({useScope:"global"}),a=t,n=A([]),o=A(!1),r=A(!1),u=()=>{n.value.length?(n.value.forEach(c=>{O.emit("personalInvite",c),O.emit("messageInvite",{uuidRoom:a.chat.uuid,titleRoom:a.chat.roomName,roomId:a.chat.id,userUuid:c}),O.emit("personalInvite",E.getData("uuid"))}),n.value.length=0,r.value=!0):o.value=!0};return(c,_)=>(i(),k(s(Z),{class:"w-[440px]",onCloseModal:_[1]||(_[1]=d=>c.$emit("closeAddUser")),"is-open-modal":c.isOpenAddUser},{default:C(()=>[l("ul",null,[l("p",St,f(s(e)("selectUser")),1),(i(!0),v(le,null,re(c.users,d=>(i(),v("li",{class:"mt-4",key:d.id},[l("div",Ut,[D(f(d.name)+" "+f(d.surname)+" ",1),ae(l("input",{type:"checkbox",value:d.uuid,"onUpdate:modelValue":_[0]||(_[0]=h=>n.value=h)},null,8,Ot),[[Ae,n.value]])])]))),128))]),g(s(L),{onClick:u,class:"mt-7 w-full","is-rounded-lg":!0},{default:C(()=>[D(f(s(e)("add")),1)]),_:1}),o.value?(i(),k(s(X),{key:0,class:"text-center mt-2","type-toast":"error"},{default:C(()=>[D(f(s(e)("inviteError")),1)]),_:1})):B("",!0),r.value?(i(),k(s(X),{key:1,class:"text-center mt-2","type-toast":"success"},{default:C(()=>[D(f(s(e)("inviteSuccess")),1)]),_:1})):B("",!0)]),_:1},8,["is-open-modal"]))}}),Lt={},jt={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 w-6"};function Nt(t,e){return i(),v("svg",jt,e[0]||(e[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"},null,-1)]))}const Pt=N(Lt,[["render",Nt]]),Bt={class:"flex flex-col h-full"},Tt={class:"text-3xl font-bold"},Et={class:"mt-4"},Ft={key:0,class:"mt-12"},Rt={class:"text-2xl"},Vt={class:"mt-4 grid grid-cols-3 gap-1"},Kt={key:1},Ht={class:"mt-4"},qt={key:0,class:"mt-auto ml-auto flex gap-2"},zt=$({__name:"AnalysisChat",props:{chat:{}},emits:["closeModal"],setup(t){const{t:e}=P({useScope:"global"}),a=t,{isOpenModal:n,closeModal:o,openModal:r}=K(),{isOpenModal:u,closeModal:c,openModal:_}=K(),d=E.getData("id"),h=ie(),w=se();w.getUsers();const I=te(),S=m=>{h.removeChat(m),et({chats:w.user.chats,id:m}),w.getUser(d!==null?+d:0),o(),I.push("/chats")},p=H({fileLength:0,textLength:0});G.register(Te,Ee,Fe);const y=async()=>{try{const m=(await q.post(`/api/analise/${a.chat.id}`)).data;p.fileLength=m.fileLength,p.textLength=m.textLength}catch{return new Error("Error fetching chat")}};z(()=>{y()}),console.log(p);const x=A({labels:[e("textMessage"),e("files")],datasets:[{backgroundColor:["#242424","#bc0ce8"],data:[p.textLength,p.fileLength]}]}),b={responsive:!0,maintainAspectRatio:!1},M=A(0);return F(()=>[p.textLength,p.fileLength],([m,U])=>{x.value.datasets[0].data=[m,U],M.value+=1}),(m,U)=>(i(),v("section",Bt,[l("div",null,[l("h1",Tt,f(m.chat.roomName),1),l("p",Et,f(m.chat.description),1),p.textLength?(i(),v("div",Ft,[l("h2",Rt,f(s(e)("analiseChat"))+":",1),l("div",Vt,[l("div",null,[(i(),k(s(Dt),{class:"chart",options:b,data:x.value,key:M.value},null,8,["data"]))])])])):(i(),v("div",Kt,"Статистики пока нету")),U[1]||(U[1]=l("div",{class:"h-[0.5px] mt-4 bg-slate-400"},null,-1)),l("div",Ht,[s(d)&&+s(d)===m.chat.userId?(i(),k(s(L),{key:0,onClick:s(_),class:"gap-2","is-rounded-lg":!0},{default:C(()=>[D(f(s(e)("inviteUsers"))+" ",1),g(Pt)]),_:1},8,["onClick"])):B("",!0)])]),s(d)&&+s(d)===m.chat.userId?(i(),v("div",qt,[g(s(L),{onClick:U[0]||(U[0]=Wt=>m.$emit("closeModal")),class:"w-32",color:"primary","is-rounded-lg":!0},{default:C(()=>[D(f(s(e)("close")),1)]),_:1}),g(s(L),{onClick:s(r),class:"w-32",color:"danger","is-rounded-lg":!0},{default:C(()=>[D(f(s(e)("deleteChat")),1)]),_:1},8,["onClick"])])):B("",!0),g(s(mt),{"is-open-modal":s(n),chatId:m.chat.id,onCloseModal:s(o),onDeleteCurrentChat:S},null,8,["is-open-modal","chatId","onCloseModal"]),g(s(At),{"is-open-add-user":s(u),users:s(w).users,chatName:m.chat.roomName,chatUuid:m.chat.uuid,chat:m.chat,onCloseAddUser:s(c)},null,8,["is-open-add-user","users","chatName","chatUuid","chat","onCloseAddUser"])]))}});const Zt=N(zt,[["__scopeId","data-v-462b9a62"]]),Gt={key:0,class:"flex flex-col justify-between min-h-screen"},Qt={key:1,class:"flex flex-col justify-center items-center min-h-screen"},es=$({__name:"Chat",setup(t){Je();const e=Le(),{isOpenModal:a,closeModal:n,openModal:o}=K(),r=T(),u=ie(),c=H({route:e.fullPath,getChat:u.getChat});let _=J(c);F(e,()=>{_=J({route:e.fullPath,getChat:u.getChat})});const d=A(!1),h=H({title:"",uuid:"",userUuid:!1,roomId:null}),w=()=>d.value=!1;O.emit("personalInvite",W.get("uuid")),O.on("messageInvite",async(S,p,y,x)=>{h.title=p,h.uuid=S,h.roomId=x,h.userUuid=y===W.get("uuid"),h.title&&h.uuid&&h.userUuid&&(d.value=!0,setTimeout(()=>d.value=!1,5e3))});const{enterChat:I}=je();return(S,p)=>(i(),k(s(Pe),null,{default:C(()=>{var y,x,b;return[(y=s(u))!=null&&y.chat?(i(),v("div",Gt,[g(s(vt),{onOpenModal:s(o),"chat-name":(b=(x=s(u))==null?void 0:x.chat)==null?void 0:b.roomName},null,8,["onOpenModal","chat-name"]),l("div",null,[(i(!0),v(le,null,re(s(r).getMessages(s(u).chat.messages),M=>(i(),k(s(Xe),{key:M.userId,message:M},null,8,["message"]))),128)),g(s(yt),{"chat-id":s(u).chat.id,uuid:s(_)},null,8,["chat-id","uuid"])])])):(i(),v("div",Qt,p[1]||(p[1]=[l("p",{class:"text-white bg-black p-2 rounded-xl"},"Чата был удален",-1)]))),g(s(Z),{class:"w-[900px] h-[800px]",onCloseModal:s(n),"is-open-modal":s(a)},{default:C(()=>[g(s(Zt),{onCloseModal:s(n),chat:s(u).chat},null,8,["onCloseModal","chat"])]),_:1},8,["onCloseModal","is-open-modal"]),g(s(Ne),{"is-invite-room":d.value,chatTitle:h.title,onEnterChat:p[0]||(p[0]=M=>s(I)(h.uuid,h.title,h.roomId,w)),onCloseNotification:w},null,8,["is-invite-room","chatTitle"])]}),_:1}))}});export{es as default};
