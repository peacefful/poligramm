import{h as q,T as _e,R as O,U as T,V as ee,W as ye,X as Ce,Y as we,Z as xe,_ as N,o as d,n as _,m as i,d as $,c as P,s as E,k as g,t as f,l as s,$ as be,u as te,z,E as $e,j as k,w as C,P as L,e as A,a0 as Me,q as I,a1 as Z,a2 as ke,a3 as se,a4 as ae,D as F,L as oe,a5 as De,N as Ie,a6 as Se,Q,K as ne,a7 as R,a8 as Ue,a9 as Oe,aa as V,G as Ae,ab as re,ac as le,F as ie,p as B,ad as Le,ae as K,af as de,r as H,b as W}from"./index-6734986a.js";import{u as je,N as Ne,M as Pe}from"./MainLayout-c7827dd1.js";import{C as G,D as Be,_ as X,p as Te,a as Ee,A as Fe}from"./chart-93d9ec52.js";const Re=async()=>{try{return(await q.get("/api/chats")).data}catch{return new Error("Error fetch chats")}},Ve=async t=>{await q.put(`/api/chats/${t.id}`,t.data)},ue=async(t,e)=>{t.sendTime=_e().format("HH:mm"),(t.text.trim()||t.file.trim())&&(t.chatId=e,O.emit("message",t),t.text="")},ce=async()=>{const t=T();O.on("message",e=>{t.setMessages(e),requestAnimationFrame(()=>{window.scrollTo(0,document.body.scrollHeight)})})},me=async t=>ee.getFileView("676081be001c55b9da7d",t),he=t=>O.emit("join",t),pe=async t=>{try{return await ee.createFile("676081be001c55b9da7d",ye.unique(),t)}catch{return null}},Y=Object.freeze(Object.defineProperty({__proto__:null,createChat:Ce,deleteChat:we,fetchChat:xe,fetchChats:Re,getFileView:me,getMessages:ce,joinToChat:he,sendMessage:ue,setFileToStorage:pe,updateChat:Ve},Symbol.toStringTag,{value:"Module"})),Ke={},He={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6 w-12 h-12"};function qe(t,e){return d(),_("svg",He,e[0]||(e[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"},null,-1)]))}const ze=N(Ke,[["render",qe]]),Ze={class:"flex flex-col"},Ge=["href"],Qe={key:1},We={class:"text-xs text-right"},Xe=$({__name:"Messages",props:{message:{}},setup(t){const{t:e}=P({useScope:"global"}),a=E.getData("id"),n=o=>o!==null?+o:0;return(o,l)=>(d(),_("div",Ze,[i("div",{class:be(["bg-default text-white rounded-2xl my-2 p-3 break-words inline-block max-w-xl",{"ml-auto mr-4":n(s(a))===+o.message.userId,"mr-auto ml-4":n(s(a))!==+o.message.userId}])},[o.message.file?(d(),_("a",{key:0,target:"_blank",class:"cursor-pointer",href:o.message.file},[g(ze)],8,Ge)):(d(),_("div",Qe,f(o.message.text),1)),i("div",We,f(n(s(a))===+o.message.userId?s(e)("you"):o.message.username)+" "+f(o.message.sendTime),1)],2)]))}}),Ye=t=>{const e=t.split("/"),a=e[e.length-2],n=e[e.length-1];return{id:a,uuid:n}},J=t=>{const{id:e,uuid:a}=Ye(t.route);return he(a),t.getChat(+e),a},Je=()=>{const t=te();function e(a){a.key==="Escape"&&t.push("/chats")}z(()=>{window.addEventListener("keydown",e)}),$e(()=>{window.removeEventListener("keydown",e)})},et=t=>(console.log("deleteChatByIndex"),t.chats.filter(e=>e.id!==t.id)),tt={},st={xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 mr-[2px] mt-[2px]",viewBox:"0 0 24 24",fill:"#fff",stroke:"#fff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"};function at(t,e){return d(),_("svg",st,e[0]||(e[0]=[i("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),i("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)]))}const ot=N(tt,[["render",at]]),nt=$({__name:"SendMessageButton",emits:["send-message"],setup(t){return(e,a)=>(d(),k(s(L),{onClick:a[0]||(a[0]=n=>e.$emit("send-message")),"is-rounded-full":!0},{default:C(()=>[g(ot)]),_:1}))}}),rt={},lt={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 24","stroke-width":"2",stroke:"#fff",class:"w-6 h-6"};function it(t,e){return d(),_("svg",lt,e[0]||(e[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"},null,-1)]))}const dt=N(rt,[["render",it]]),ut=$({__name:"SendFileButton",setup(t){const e=A(""),a=T(),n=async o=>{const l=o.target;if(l.files!==null){const u=await pe(l.files[0]);u&&(e.value=await me(u==null?void 0:u.$id),a.messagesData.file=e.value,console.log("messagesStore.messagesData",a.messagesData),a.messagesData.userId=+a.messagesData.userId,ue(a.messagesData,a.messagesData.chatId))}};return(o,l)=>(d(),k(s(Me),{onOnFileChange:n,type:"file",class:"p-2 mr-4 hover:rotate-90 ease-in duration-150"},{default:C(()=>[g(dt)]),_:1}))}}),ct={class:"flex justify-center gap-3 mt-4"},mt=$({__name:"ConfirmDeleteChatModal",props:{isOpenModal:{type:Boolean},chatId:{}},emits:["closeModal","deleteCurrentChat"],setup(t){const{t:e}=P({useScope:"global"});return(a,n)=>(d(),k(s(Z),{onCloseModal:n[2]||(n[2]=o=>a.$emit("closeModal")),"is-open-modal":a.isOpenModal},{default:C(()=>[i("h3",null,f(s(e)("confirmDelete")),1),i("div",ct,[g(s(L),{onClick:n[0]||(n[0]=o=>a.$emit("deleteCurrentChat",a.chatId)),class:"w-20",color:"primary","is-rounded-lg":!0},{default:C(()=>[I(f(s(e)("yes")),1)]),_:1}),g(s(L),{onClick:n[1]||(n[1]=o=>a.$emit("closeModal")),class:"w-20","is-rounded-lg":!0},{default:C(()=>[I(f(s(e)("no")),1)]),_:1})])]),_:1},8,["is-open-modal"]))}}),ht={class:"fixed top-0 left-[383px] right-0 bg-white h-[70px] px-4 flex justify-between items-center"},pt={class:"flex items-center"},ft={class:"bg-default p-2 rounded-full mr-2"},gt={class:"font-bold text-xl"},vt=$({__name:"ChatHeader",props:{chatName:{}},emits:["openModal"],setup(t){return(e,a)=>(d(),_("header",{onClick:a[0]||(a[0]=n=>e.$emit("openModal")),class:"cursor-pointer mb-20"},[i("div",ht,[i("div",pt,[i("div",ft,[g(s(ke),{class:"h-8 w-8",name:"usersGroup"})]),i("h1",gt,f(e.chatName),1)])])]))}}),_t=["placeholder"],yt=$({__name:"SendMessageForm",props:{uuid:{},chatId:{}},setup(t){const e=t,{t:a}=P({useScope:"global"}),n=se(),o=T(),l=String(E.getData("id")),u=ae();return o.setMessagesData({userId:l,chatId:+u.params.id,text:"",sendTime:"",file:"",username:n.username,uuid:e.uuid}),F(e,()=>{o.messagesData.uuid=e.uuid}),ce(),(m,v)=>(d(),_("form",{autocomplete:"off",onSubmit:v[2]||(v[2]=Q(r=>s(Y).sendMessage(s(o).messagesData,m.chatId),["prevent"])),class:"relative bottom-0 mx-0 mb-0 rounded-none md:sticky md:bottom-3 md:mx-4 md:mb-3 md:rounded-2xl flex justify-center items-center bg-white px-6"},[g(s(ut)),oe(i("textarea",Ie({onKeydown:v[0]||(v[0]=Se(Q(r=>s(Y).sendMessage(s(o).messagesData,m.chatId),["prevent"]),["enter"]))},m.$attrs,{class:"outline-none border-solid resize-none overflow-hidden w-full pt-5",placeholder:s(a)("writeMessage"),"onUpdate:modelValue":v[1]||(v[1]=r=>s(o).messagesData.text=r)}),null,16,_t),[[De,s(o).messagesData.text]]),g(s(nt))],32))}}),fe={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},Ct={ariaLabel:{type:String},ariaDescribedby:{type:String}},wt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...fe,...Ct},xt=Ue[0]==="2"?(t,e)=>Object.assign(t,{attrs:e}):(t,e)=>Object.assign(t,e);function j(t){return re(t)?V(t):t}function bt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;return re(e)?new Proxy(t,{}):t}function $t(t,e){const a=t.options;a&&e&&Object.assign(a,e)}function ge(t,e){t.labels=e}function ve(t,e,a){const n=[];t.datasets=e.map(o=>{const l=t.datasets.find(u=>u[a]===o[a]);return!l||!o.data||n.includes(l)?{...o}:(n.push(l),Object.assign(l,o),l)})}function Mt(t,e){const a={labels:[],datasets:[]};return ge(a,t.labels),ve(a,t.datasets,e),a}const kt=$({props:wt,setup(t,e){let{expose:a,slots:n}=e;const o=A(null),l=ne(null);a({chart:l});const u=()=>{if(!o.value)return;const{type:r,data:h,options:w,plugins:D,datasetIdKey:S}=t,p=Mt(h,S),y=bt(p,h);l.value=new G(o.value,{type:r,data:y,options:{...w},plugins:D})},m=()=>{const r=V(l.value);r&&(t.destroyDelay>0?setTimeout(()=>{r.destroy(),l.value=null},t.destroyDelay):(r.destroy(),l.value=null))},v=r=>{r.update(t.updateMode)};return z(u),Oe(m),F([()=>t.options,()=>t.data],(r,h)=>{let[w,D]=r,[S,p]=h;const y=V(l.value);if(!y)return;let x=!1;if(w){const b=j(w),M=j(S);b&&b!==M&&($t(y,b),x=!0)}if(D){const b=j(D.labels),M=j(p.labels),c=j(D.datasets),U=j(p.datasets);b!==M&&(ge(y.config.data,b),x=!0),c&&c!==U&&(ve(y.config.data,c,t.datasetIdKey),x=!0)}x&&Ae(()=>{v(y)})},{deep:!0}),()=>R("canvas",{role:"img",ariaLabel:t.ariaLabel,ariaDescribedby:t.ariaDescribedby,ref:o},[R("p",{},[n.default?n.default():""])])}});function Dt(t,e){return G.register(e),$({props:fe,setup(a,n){let{expose:o}=n;const l=ne(null),u=m=>{l.value=m==null?void 0:m.chart};return o({chart:l}),()=>R(kt,xt({ref:u},{type:t,...a}))}})}const It=Dt("doughnut",Be),St={class:"font-bold text-[20px]"},Ut={class:"flex justify-between"},Ot=["value"],At=$({__name:"inviteUsers",props:{isOpenAddUser:{type:Boolean},users:{},chatName:{},chatUuid:{},chat:{}},emits:["closeAddUser"],setup(t){const{t:e}=P({useScope:"global"}),a=t,n=A([]),o=A(!1),l=A(!1),u=()=>{n.value.length?(n.value.forEach(m=>{O.emit("personalInvite",m),O.emit("messageInvite",{uuidRoom:a.chat.uuid,titleRoom:a.chat.roomName,roomId:a.chat.id,userUuid:m}),O.emit("personalInvite",E.getData("uuid"))}),n.value.length=0,l.value=!0):o.value=!0};return(m,v)=>(d(),k(s(Z),{class:"w-[440px]",onCloseModal:v[1]||(v[1]=r=>m.$emit("closeAddUser")),"is-open-modal":m.isOpenAddUser},{default:C(()=>[i("ul",null,[i("p",St,f(s(e)("selectUser")),1),(d(!0),_(ie,null,le(m.users,r=>(d(),_("li",{class:"mt-4",key:r.id},[i("div",Ut,[I(f(r.name)+" "+f(r.surname)+" ",1),oe(i("input",{type:"checkbox",value:r.uuid,"onUpdate:modelValue":v[0]||(v[0]=h=>n.value=h)},null,8,Ot),[[Le,n.value]])])]))),128))]),g(s(L),{onClick:u,class:"mt-7 w-full","is-rounded-lg":!0},{default:C(()=>[I(f(s(e)("add")),1)]),_:1}),o.value?(d(),k(s(X),{key:0,class:"text-center mt-2","type-toast":"error"},{default:C(()=>[I(f(s(e)("inviteError")),1)]),_:1})):B("",!0),l.value?(d(),k(s(X),{key:1,class:"text-center mt-2","type-toast":"success"},{default:C(()=>[I(f(s(e)("inviteSuccess")),1)]),_:1})):B("",!0)]),_:1},8,["is-open-modal"]))}}),Lt={},jt={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 w-6"};function Nt(t,e){return d(),_("svg",jt,e[0]||(e[0]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"},null,-1)]))}const Pt=N(Lt,[["render",Nt]]),Bt={class:"flex flex-col h-full"},Tt={class:"text-3xl font-bold"},Et={class:"mt-4"},Ft={key:0,class:"mt-12"},Rt={class:"text-2xl"},Vt={class:"mt-4 grid grid-cols-3 gap-1"},Kt={key:1},Ht={class:"mt-4"},qt={key:0,class:"mt-auto ml-auto flex gap-2"},zt=$({__name:"AnalysisChat",props:{chat:{}},emits:["closeModal"],setup(t){const{t:e}=P({useScope:"global"}),a=t,{isOpenModal:n,closeModal:o,openModal:l}=K(),{isOpenModal:u,closeModal:m,openModal:v}=K(),r=E.getData("id"),h=de(),w=se();w.getUsers();const D=te(),S=c=>{h.removeChat(c),et({chats:w.user.chats,id:c}),w.getUser(r!==null?+r:0),o(),D.push("/chats")},p=H({fileLength:0,textLength:0});G.register(Te,Ee,Fe);const y=async()=>{try{const c=(await q.post(`/api/analise/${a.chat.id}`)).data;p.fileLength=c.fileLength,p.textLength=c.textLength}catch{return new Error("Error fetching chat")}};z(()=>{y()}),console.log(p);const x=A({labels:[e("textMessage"),e("files")],datasets:[{backgroundColor:["#242424","#bc0ce8"],data:[p.textLength,p.fileLength]}]}),b={responsive:!0,maintainAspectRatio:!1},M=A(0);return F(()=>[p.textLength,p.fileLength],([c,U])=>{x.value.datasets[0].data=[c,U],M.value+=1}),(c,U)=>(d(),_("section",Bt,[i("div",null,[i("h1",Tt,f(c.chat.roomName),1),i("p",Et,f(c.chat.description),1),p.textLength?(d(),_("div",Ft,[i("h2",Rt,f(s(e)("analiseChat"))+":",1),i("div",Vt,[i("div",null,[(d(),k(s(It),{class:"chart",options:b,data:x.value,key:M.value},null,8,["data"]))])])])):(d(),_("div",Kt,"Статистики пока нету")),U[1]||(U[1]=i("div",{class:"h-[0.5px] mt-4 bg-slate-400"},null,-1)),i("div",Ht,[s(r)&&+s(r)===c.chat.userId?(d(),k(s(L),{key:0,onClick:s(v),class:"gap-2","is-rounded-lg":!0},{default:C(()=>[I(f(s(e)("inviteUsers"))+" ",1),g(Pt)]),_:1},8,["onClick"])):B("",!0)])]),s(r)&&+s(r)===c.chat.userId?(d(),_("div",qt,[g(s(L),{onClick:U[0]||(U[0]=Wt=>c.$emit("closeModal")),class:"w-32",color:"primary","is-rounded-lg":!0},{default:C(()=>[I(f(s(e)("close")),1)]),_:1}),g(s(L),{onClick:s(l),class:"w-32",color:"danger","is-rounded-lg":!0},{default:C(()=>[I(f(s(e)("deleteChat")),1)]),_:1},8,["onClick"])])):B("",!0),g(s(mt),{"is-open-modal":s(n),chatId:c.chat.id,onCloseModal:s(o),onDeleteCurrentChat:S},null,8,["is-open-modal","chatId","onCloseModal"]),g(s(At),{"is-open-add-user":s(u),users:s(w).users,chatName:c.chat.roomName,chatUuid:c.chat.uuid,chat:c.chat,onCloseAddUser:s(m)},null,8,["is-open-add-user","users","chatName","chatUuid","chat","onCloseAddUser"])]))}});const Zt=N(zt,[["__scopeId","data-v-462b9a62"]]),Gt={key:0,class:"flex flex-col justify-between min-h-screen"},Qt={key:1,class:"flex flex-col justify-center items-center min-h-screen"},es=$({__name:"Chat",setup(t){Je();const e=ae(),{isOpenModal:a,closeModal:n,openModal:o}=K(),l=T(),u=de(),m=H({route:e.fullPath,getChat:u.getChat});let v=J(m);F(e,()=>{v=J({route:e.fullPath,getChat:u.getChat})});const r=A(!1),h=H({title:"",uuid:"",userUuid:!1,roomId:null}),w=()=>r.value=!1;O.emit("personalInvite",W.get("uuid")),O.on("messageInvite",async(S,p,y,x)=>{h.title=p,h.uuid=S,h.roomId=x,h.userUuid=y===W.get("uuid"),h.title&&h.uuid&&h.userUuid&&(r.value=!0,setTimeout(()=>r.value=!1,5e3))});const{enterChat:D}=je();return(S,p)=>(d(),k(s(Pe),null,{default:C(()=>{var y,x,b;return[(y=s(u))!=null&&y.chat?(d(),_("div",Gt,[g(s(vt),{onOpenModal:s(o),"chat-name":(b=(x=s(u))==null?void 0:x.chat)==null?void 0:b.roomName},null,8,["onOpenModal","chat-name"]),i("div",null,[(d(!0),_(ie,null,le(s(l).getMessages(s(u).chat.messages),M=>(d(),k(s(Xe),{key:M.userId,message:M},null,8,["message"]))),128)),g(s(yt),{"chat-id":s(u).chat.id,uuid:s(v)},null,8,["chat-id","uuid"])])])):(d(),_("div",Qt,p[1]||(p[1]=[i("p",{class:"text-white bg-black p-2 rounded-xl"},"Чата был удален",-1)]))),g(s(Z),{class:"w-[900px] h-[800px]",onCloseModal:s(n),"is-open-modal":s(a)},{default:C(()=>[g(s(Zt),{onCloseModal:s(n),chat:s(u).chat},null,8,["onCloseModal","chat"])]),_:1},8,["onCloseModal","is-open-modal"]),g(s(Ne),{"is-invite-room":r.value,chatTitle:h.title,onEnterChat:p[0]||(p[0]=M=>s(D)(h.uuid,h.title,h.roomId,w)),onCloseNotification:w},null,8,["is-invite-room","chatTitle"])]}),_:1}))}});export{es as default};
